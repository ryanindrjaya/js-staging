_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[54],{"85bS":function(t,e,a){"use strict";a.r(e);var n=a("rg98"),r=a("vJKn"),s=a.n(r),i=(a("q1tI"),a("NyWP")),o=a.n(i),c=(a("wd/R"),o.a.get(null,"token"));var u=function(){var t=Object(n.a)(s.a.mark((function t(e,a,n){var r,i,o,u;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r="https://js-strapi.keelola.net/api"+"/inventory-details?filters[locations][id][$eq]=".concat(n,"&filters[products][id][$eq]=").concat(a,"&filters[expired_date][$eq]=2024-10-01&populate=*"),i={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+c.token}},t.next=4,fetch(r,i);case 4:return o=t.sent,t.next=7,o.json();case 7:(u=t.sent).data.length>0?p(u.data[0],e,a,n):l(e,a,n),d(e);case 10:case"end":return t.stop()}}),t)})));return function(e,a,n){return t.apply(this,arguments)}}(),p=function(){var t=Object(n.a)(s.a.mark((function t(e,a,n,r){var i,o,u,p,l,d,f;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.attributes.stock,o=i+a.data.stock,e.attributes.stock=o,e.attributes.locations=a.data.locations,e.attributes.products=a.data.products,u={data:e.attributes},p=JSON.stringify(u),l="https://js-strapi.keelola.net/api/inventory-details/"+e.id,d={method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+c.token},body:p},t.next=11,fetch(l,d);case 11:return f=t.sent,t.next=14,f.json();case 14:t.sent,200===f.status&&h(r,n,a.data.stock,a);case 16:case"end":return t.stop()}}),t)})));return function(e,a,n,r){return t.apply(this,arguments)}}(),l=function(){var t=Object(n.a)(s.a.mark((function t(e,a,n){var r,i,o;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=JSON.stringify(e),"https://js-strapi.keelola.net/api/inventory-details",i={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+c.token},body:r},t.next=5,fetch("https://js-strapi.keelola.net/api/inventory-details",i);case 5:return o=t.sent,t.next=8,o.json();case 8:t.sent,200===o.status&&h(n,a,e.data.stock,e);case 10:case"end":return t.stop()}}),t)})));return function(e,a,n){return t.apply(this,arguments)}}(),d=function(){var t=Object(n.a)(s.a.mark((function t(e){var a,n,r;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=JSON.stringify(e),"https://js-strapi.keelola.net/api/inventory-histories",n={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+c.token},body:a},t.next=5,fetch("https://js-strapi.keelola.net/api/inventory-histories",n);case 5:return r=t.sent,t.next=8,r.json();case 8:t.sent;case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),h=function(){var t=Object(n.a)(s.a.mark((function t(e,a,n,r){var i,o,u,p,l;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i="https://js-strapi.keelola.net/api"+"/inventories?filters[locations][id][$eq]=".concat(e,"&filters[products][id][$eq]=").concat(a,"&populate=locations"),o={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+c.token}},t.next=4,fetch(i,o);case 4:return u=t.sent,t.next=7,u.json();case 7:if(!((p=t.sent).data.length>0)){t.next=14;break}return l=p.data[0].attributes.total_stock+n,t.next=12,f(p.data[0].id,p.data[0].attributes,l);case 12:t.next=16;break;case 14:return t.next=16,b(r,e);case 16:case"end":return t.stop()}}),t)})));return function(e,a,n,r){return t.apply(this,arguments)}}(),f=function(){var t=Object(n.a)(s.a.mark((function t(e,a,n){var r,i,o,u;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.total_stock=n,a.locations={id:a.locations.data[0].id},r={data:a},i=JSON.stringify(r),o="https://js-strapi.keelola.net/api/inventories/"+e,u={method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+c.token},body:i},t.next=8,fetch(o,u);case 8:t.sent;case 9:case"end":return t.stop()}}),t)})));return function(e,a,n){return t.apply(this,arguments)}}(),b=function(){var t=Object(n.a)(s.a.mark((function t(e,a){var n,r;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.data.total_stock=e.data.stock,e.data.locations={id:a},n=JSON.stringify(e),"https://js-strapi.keelola.net/api/inventories",r={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+c.token},body:n},t.next=7,fetch("https://js-strapi.keelola.net/api/inventories",r);case 7:t.sent;case 8:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}();e.default=function(t){t.attributes.purchasing_details.data.forEach((function(t){var e=new Date(t.attributes.expired_date),a=t.attributes.batch,n=t.attributes.unit_order,r=parseInt(t.attributes.total_order),s=t.attributes.product.data,i=function(t,e){for(var a=1,n=0,r="",s=1;s<6;s++)e.attributes["unit_".concat(s)]===t&&(n=s),e.attributes["unit_".concat(s)]&&(r=e.attributes["unit_".concat(s)]);for(var i=n+1;i<6;i++)0===(a*=e.attributes["qty_".concat(i)])&&(a=1);return{total:a,productSmallestUnit:r}}(n,s),o=i.total*r,c=t.attributes.location.data,p={data:{expired_date:e,batch:a,products:{id:s.id},stock:o,smallest_unit:i.productSmallestUnit,locations:{id:c.id},keterangan:"Pembelian"}};u(p,s.id,c.id)}))}},AYpC:function(t,e,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/pembelian/pembelian_barang",function(){return a("t4Ct")}])},rg98:function(t,e,a){"use strict";function n(t,e,a,n,r,s,i){try{var o=t[s](i),c=o.value}catch(u){return void a(u)}o.done?e(c):Promise.resolve(c).then(n,r)}function r(t){return function(){var e=this,a=arguments;return new Promise((function(r,s){var i=t.apply(e,a);function o(t){n(i,r,s,o,c,"next",t)}function c(t){n(i,r,s,o,c,"throw",t)}o(void 0)}))}}a.d(e,"a",(function(){return r}))},t4Ct:function(t,e,a){"use strict";a.r(e);var n=a("rR1Q"),r=a.n(n),s=a("iJl9"),i=a.n(s),o=a("rg98"),c=a("vJKn"),u=a.n(c),p=a("g4pe"),l=a.n(p),d=a("q1tI"),h=a("kM/w"),f=a("0Jbt"),b=a("PKTO"),j=a("20a2"),v=a("xBBV"),k=a("kc6U"),x=a("NyWP"),m=a.n(x),y=a("85bS"),g=a("nKUr");O.getInitialProps=function(){var t=Object(o.a)(u.a.mark((function t(e){var a,n,r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=m.a.get(e),t.next=3,w(a);case 3:return r=t.sent,t.next=6,r.json();case 6:return n=t.sent,t.abrupt("return",{props:{data:n}});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();var w=function(){var t=Object(o.a)(u.a.mark((function t(e){var a,n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"https://js-strapi.keelola.net/api/purchasings?populate=deep",a={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e.token}},t.next=4,fetch("https://js-strapi.keelola.net/api/purchasings?populate=deep",a);case 4:return n=t.sent,t.abrupt("return",n);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();function O(t){var e=t.props.data,a=Object(d.useState)(e),n=a[0],s=a[1],c=Object(d.useState)(!1),p=c[0],x=(c[1],i.a.Search),w=Object(j.useRouter)(),O=function(){var t=Object(o.a)(u.a.mark((function t(e){var a,n,r,i,o;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=m.a.get(null,"token"),n="https://js-strapi.keelola.net/api/purchases?pagination[page]="+e,r={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a.token}},t.prev=3,t.next=6,fetch(n,r);case 6:return i=t.sent,t.next=9,i.json();case 9:(o=t.sent)?s((function(t){return{data:filterDuplicateData(t.data.concat(o.data)),meta:t.meta}})):console.log("something is wrong"),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(3),console.log(t.t0);case 16:case"end":return t.stop()}}),t,null,[[3,13]])})));return function(e){return t.apply(this,arguments)}}(),_=function(){var t=Object(o.a)(u.a.mark((function t(e){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),T=function(){var t=Object(o.a)(u.a.mark((function t(e,a){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:S("Dibatalkan",a);case 1:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),S=function(t,e){e.attributes.status=t;var a=e;"Selesai"===t&&Object(y.default)(e),P(a,a.id)},P=function(){var t=Object(o.a)(u.a.mark((function t(e,a){var n,r,i,o,c,p,l,d,h,f,b,j,v,k,x,y;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(c in delete e.attributes.purchase,e.attributes)null!==e.attributes[c]&&void 0!==e.attributes[c]||delete e.attributes[c];return null!==(null===(n=e.attributes)||void 0===n||null===(r=n.document)||void 0===r?void 0:r.data)&&void 0!==(null===(i=e.attributes)||void 0===i||null===(o=i.document)||void 0===o?void 0:o.data)||null===(p=e.attributes)||void 0===p||delete p.document,l=[],d=[],e.attributes.purchasing_details.data.forEach((function(t){l.push({id:t.id})})),e.attributes.purchasing_payments.data.forEach((function(t){d.push({id:t.id})})),e.attributes.supplier={id:e.attributes.supplier.data.id},e.attributes.location={id:e.attributes.location.data.id},e.attributes.purchasing_details=l,e.attributes.purchasing_payments=d,h={data:e.attributes},f=JSON.stringify(h),b=m.a.get(null,"token"),j="https://js-strapi.keelola.net/api/purchasings/"+a,v={method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+b.token},body:f},t.next=18,fetch(j,v);case 18:return k=t.sent,t.next=21,k.json();case 21:if(x=t.sent,200!==k.status){t.next=30;break}return t.next=25,C(b);case 25:y=t.sent,"Dibatalkan"===x.data.attributes.status?w.reload():s(y),N("success","Status berhasil dirubah","Status berhasil dirubah. Silahkan cek detail LPB"),t.next=31;break;case 30:N("error","Status gagal dirubah","Tedapat kesalahan yang menyebabkan status tidak dapat dirubah");case 31:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),C=function(){var t=Object(o.a)(u.a.mark((function t(e){var a,n,r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"https://js-strapi.keelola.net/api/purchasings?populate=deep",a={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e.token}},t.next=4,fetch("https://js-strapi.keelola.net/api/purchasings?populate=deep",a);case 4:return n=t.sent,r=n.json(),t.abrupt("return",r);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),N=function(t,e,a){r.a[t]({message:e,description:a})};return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(l.a,{children:Object(g.jsx)("title",{children:"Pembelian Barang"})}),Object(g.jsx)(f.a,{children:Object(g.jsxs)(b.a,{style:{},children:[Object(g.jsx)(v.a,{titleText:"Lembar Pembelian Barang"}),Object(g.jsxs)(h.a,{children:[Object(g.jsxs)("div",{className:"w-full flex justify-between",children:[Object(g.jsx)(x,{className:"",loading:p,onChange:function(t){return _(t)},placeholder:"Cari Pembelian",style:{width:200}}),Object(g.jsx)("button",{onClick:function(){w.push("/dashboard/pembelian/pembelian_barang/tambah")},type:"button",className:"bg-cyan-700 rounded px-5 py-2 hover:bg-cyan-800  shadow-sm flex float-right mb-5",children:Object(g.jsx)("div",{className:"text-white text-center text-sm font-bold",children:Object(g.jsx)("a",{className:"text-white no-underline text-xs sm:text-xs",children:"+ Tambah"})})})]}),Object(g.jsx)(k.a,{data:n,onUpdate:function(t){N("info","Work In Progress","Hai, Fitur ini sedang dikerjakan. Silahkan tunggu pembaruan selanjutnya")},onDelete:T,onPageChange:O,onChangeStatus:S})]})]})})]})}e.default=O}},[["AYpC",0,1,13,20,2,3,4,5,6,7,9,8,10,12,11,14,16,17,18,19,24]]]);