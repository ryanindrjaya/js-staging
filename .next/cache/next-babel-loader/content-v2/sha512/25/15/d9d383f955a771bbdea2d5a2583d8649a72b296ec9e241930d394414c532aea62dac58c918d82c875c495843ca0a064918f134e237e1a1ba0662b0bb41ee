{"ast":null,"code":"import React from \"react\";\nimport nookies from \"nookies\";\nimport * as moment from \"moment\";\nvar tempListId = [];\nconst cookies = nookies.get(null, \"token\");\n\nconst createDetailOrder = (values, products, productTotalPrice, productSubTotal, setListId, url) => {\n  // console.log(values);\n  console.log(\"values\", values);\n  console.log(\"product\", products);\n  console.log(\"productList\", products.productList);\n  products.productList.forEach(element => {\n    var _products$productInfo, _products$productInfo2, _products$productInfo3, _products$productInfo4, _products$productInfo5, _products$productInfo6, _products$productInfo7, _products$productInfo8, _products$productInfo9;\n\n    // default value\n    var qty = 1;\n    var disc = 0;\n    var unit = element.attributes.unit_1;\n    var unitPrice = element.attributes.buy_price_1;\n    var unitPriceAfterDisc = element.attributes.buy_price_1;\n    var subTotal = unitPriceAfterDisc * qty;\n    const id = element.id;\n    var batch = values.batch[id];\n    var location = values.product_location[id];\n    var expDate = new Date(values.exp_date[id]);\n    var newExptDate = moment.utc(expDate).utcOffset(7 * 60).format();\n    qty = (_products$productInfo = (_products$productInfo2 = products.productInfo[id]) === null || _products$productInfo2 === void 0 ? void 0 : _products$productInfo2.qty) !== null && _products$productInfo !== void 0 ? _products$productInfo : 1;\n    disc = (_products$productInfo3 = (_products$productInfo4 = products.productInfo[id]) === null || _products$productInfo4 === void 0 ? void 0 : _products$productInfo4.disc) !== null && _products$productInfo3 !== void 0 ? _products$productInfo3 : 0;\n    unit = (_products$productInfo5 = (_products$productInfo6 = products.productInfo[id]) === null || _products$productInfo6 === void 0 ? void 0 : _products$productInfo6.unit) !== null && _products$productInfo5 !== void 0 ? _products$productInfo5 : element.attributes.unit_1;\n    unitPrice = (_products$productInfo7 = (_products$productInfo8 = products.productInfo) === null || _products$productInfo8 === void 0 ? void 0 : (_products$productInfo9 = _products$productInfo8[id]) === null || _products$productInfo9 === void 0 ? void 0 : _products$productInfo9.priceUnit) !== null && _products$productInfo7 !== void 0 ? _products$productInfo7 : element.attributes.buy_price_1;\n    unitPriceAfterDisc = productTotalPrice === null || productTotalPrice === void 0 ? void 0 : productTotalPrice[id];\n    subTotal = productSubTotal === null || productSubTotal === void 0 ? void 0 : productSubTotal[id];\n    console.log(\"new data\", batch, location, expDate, newExptDate);\n    POSTPurchaseDetail(qty, disc, unit, unitPrice, unitPriceAfterDisc, subTotal, id, setListId, products, batch, location, newExptDate, url);\n  });\n};\n\nconst POSTPurchaseDetail = async (qty, disc, unit, unitPrice, unitPriceAfterDisc, subTotal, id, setListId, products, batch, location, expDate, url) => {\n  var data = {\n    data: {\n      total_order: String(qty),\n      unit_order: unit,\n      unit_price: unitPrice,\n      unit_price_after_disc: parseInt(unitPriceAfterDisc),\n      sub_total: parseInt(subTotal),\n      product: {\n        id: id\n      },\n      disc: parseInt(disc),\n      batch: batch,\n      location: {\n        id: location\n      },\n      expired_date: expDate\n    }\n  };\n  const endpoint = process.env.NEXT_PUBLIC_URL + url;\n  const JSONdata = JSON.stringify(data);\n  const options = {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: \"Bearer \" + cookies.token\n    },\n    body: JSONdata\n  };\n  const req = await fetch(endpoint, options);\n  const res = await req.json();\n\n  if (req.status === 200) {\n    var _res$data;\n\n    tempListId.push((_res$data = res.data) === null || _res$data === void 0 ? void 0 : _res$data.id);\n\n    if (tempListId.length === products.productList.length) {\n      setListId(tempListId);\n    }\n  }\n};\n\nexport default createDetailOrder;","map":null,"metadata":{},"sourceType":"module"}