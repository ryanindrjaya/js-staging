{"ast":null,"code":"import _Alert from \"antd/lib/alert\";\nimport _Spin from \"antd/lib/spin\";\nimport _defineProperty from \"/Users/yudiananta/Development/NextJS/ERP Dev/JS Deploy/ERP-Sejati/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"/Users/yudiananta/Development/NextJS/ERP Dev/JS Deploy/ERP-Sejati/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport _regeneratorRuntime from \"/Users/yudiananta/Development/NextJS/ERP Dev/JS Deploy/ERP-Sejati/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport React, { useState } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useRouter } from \"next/router\";\nimport Input from \"@iso/components/uielements/input\";\nimport Button from \"@iso/components/uielements/button\";\nimport IntlMessages from \"@iso/components/utility/intlMessages\";\nimport authActions from \"../authentication/actions\";\nimport SignInStyleWrapper from \"../styled/SignIn.styles\";\nimport nookies from \"nookies\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar login = authActions.login;\nexport default function SignInPage(props) {\n  var dispatch = useDispatch();\n  var router = useRouter();\n\n  var _useState = useState(false),\n      loading = _useState[0],\n      setLoading = _useState[1];\n\n  var _useState2 = useState(false),\n      failedLogin = _useState2[0],\n      setFailedLogin = _useState2[1];\n\n  var _useState3 = useState(\"Username atau Password salah\"),\n      failedLoginMsg = _useState3[0],\n      setfailedLoginMsg = _useState3[1];\n\n  var _useState4 = useState({}),\n      field = _useState4[0],\n      setField = _useState4[1];\n\n  var handleLogin = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n      var credentials, JSONdata, endpoint, options, req, res, role;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              e.preventDefault();\n              setFailedLogin(false);\n              setLoading(true);\n              credentials = {\n                identifier: field.username,\n                password: field.password\n              };\n              JSONdata = JSON.stringify(credentials);\n              endpoint = process.env.NEXT_PUBLIC_URL + \"/auth/local\";\n              options = {\n                method: \"POST\",\n                headers: {\n                  \"Content-Type\": \"application/json\"\n                },\n                body: JSONdata\n              };\n              _context.prev = 7;\n              _context.next = 10;\n              return fetch(endpoint, options);\n\n            case 10:\n              req = _context.sent;\n              _context.next = 13;\n              return req.json();\n\n            case 13:\n              res = _context.sent;\n\n              if (!res.jwt) {\n                _context.next = 23;\n                break;\n              }\n\n              // set new token\n              nookies.set(null, \"token\", res.jwt, {\n                maxAge: 30 * 24 * 60 * 60,\n                path: \"/\",\n                secure: process.env.NEXT_PUBLIC_URL !== \"development\",\n                sameSite: \"strict\"\n              });\n              _context.next = 18;\n              return getUserInformation(res.jwt);\n\n            case 18:\n              role = _context.sent;\n              // set role token\n              nookies.set(null, \"role\", role, {\n                maxAge: 30 * 24 * 60 * 60,\n                path: \"/\",\n                secure: process.env.NEXT_PUBLIC_URL !== \"development\",\n                sameSite: \"strict\"\n              }); // redirect\n\n              router.replace(\"/dashboard\");\n              _context.next = 24;\n              break;\n\n            case 23:\n              setFailedLogin(true);\n\n            case 24:\n              _context.next = 30;\n              break;\n\n            case 26:\n              _context.prev = 26;\n              _context.t0 = _context[\"catch\"](7);\n              setFailedLogin(true);\n              setfailedLoginMsg(\"Kesalahan Pada Server. Silahkan cek kembali\");\n\n            case 30:\n              setLoading(false);\n\n            case 31:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[7, 26]]);\n    }));\n\n    return function handleLogin(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var getUserInformation = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(jwt) {\n      var endpoint, options, req, res;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              endpoint = process.env.NEXT_PUBLIC_URL + \"/users/me?populate=role\";\n              options = {\n                method: \"GET\",\n                headers: {\n                  \"Content-Type\": \"application/json\",\n                  Authorization: \"Bearer \" + jwt\n                }\n              };\n              _context2.next = 4;\n              return fetch(endpoint, options);\n\n            case 4:\n              req = _context2.sent;\n              _context2.next = 7;\n              return req.json();\n\n            case 7:\n              res = _context2.sent;\n              console.log(res);\n              return _context2.abrupt(\"return\", res);\n\n            case 10:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function getUserInformation(_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var onClose = function onClose(e) {\n    console.log(e, \"I was closed.\");\n  };\n\n  function setValue(e) {\n    var target = e.target;\n    var name = target.name;\n    var value = target.value;\n    setField(_objectSpread(_objectSpread({}, field), {}, _defineProperty({}, name, value)));\n  } // =========================== UI ===========================\n\n\n  return /*#__PURE__*/_jsx(SignInStyleWrapper, {\n    className: \"isoSignInPage\",\n    children: /*#__PURE__*/_jsx(\"div\", {\n      className: \"isoLoginContentWrapper\",\n      children: /*#__PURE__*/_jsxs(\"div\", {\n        className: \"isoLoginContent\",\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: \"isoLogoWrapper\",\n          children: \"JAYA SEHAT\"\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"isoSignInForm\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"isoInputWrapper\",\n            children: /*#__PURE__*/_jsx(Input, {\n              onChange: setValue,\n              name: \"username\",\n              id: \"inputUserName\",\n              size: \"large\",\n              placeholder: \"Username\"\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"isoInputWrapper\",\n            children: /*#__PURE__*/_jsx(Input, {\n              onChange: setValue,\n              id: \"inpuPassword\",\n              size: \"large\",\n              name: \"password\",\n              type: \"password\",\n              placeholder: \"Password\"\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"isoInputWrapper isoLeftRightComponent\",\n            children: loading ? /*#__PURE__*/_jsx(\"div\", {\n              className: \"center\",\n              children: /*#__PURE__*/_jsx(_Spin, {})\n            }) : /*#__PURE__*/_jsx(Button, {\n              type: \"primary\",\n              onClick: handleLogin,\n              children: /*#__PURE__*/_jsx(IntlMessages, {\n                id: \"page.signInButton\"\n              })\n            })\n          }), failedLogin ? /*#__PURE__*/_jsx(_Alert, {\n            message: \"Login Error\",\n            description: \"Username atau Password salah\",\n            type: \"error\",\n            closable: true,\n            onClose: onClose\n          }) : /*#__PURE__*/_jsx(\"div\", {})]\n        })]\n      })\n    })\n  });\n}","map":null,"metadata":{},"sourceType":"module"}