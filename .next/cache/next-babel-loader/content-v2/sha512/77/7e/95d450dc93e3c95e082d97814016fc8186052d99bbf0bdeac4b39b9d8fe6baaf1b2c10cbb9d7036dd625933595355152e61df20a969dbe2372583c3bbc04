{"ast":null,"code":"import _asyncToGenerator from \"/Users/yudiananta/Development/NextJS/ERP Dev/JS Deploy/JS-Deploy/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _regeneratorRuntime from \"/Users/yudiananta/Development/NextJS/ERP Dev/JS Deploy/JS-Deploy/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport React from \"react\";\nimport nookies from \"nookies\";\nimport * as moment from \"moment\";\nvar tempListId = [];\nvar cookies = nookies.get(null, \"token\");\n\nvar getUnitPrice = function getUnitPrice(data, unit) {\n  var unitIndex = 1;\n\n  for (var index = 1; index < 6; index++) {\n    if (data.attributes[\"unit_\".concat(index)] === unit) {\n      unitIndex = index;\n    }\n  }\n\n  var selectedUnit = data.attributes[\"buy_price_\".concat(unitIndex)];\n  return selectedUnit;\n};\n\nvar createDetailOrder = function createDetailOrder(products, productTotalPrice, productSubTotal, setListId, url) {\n  products.productList.forEach(function (element) {\n    var _products$productInfo, _products$productInfo2, _products$productInfo3, _products$productInfo4, _products$productInfo5, _products$productInfo6, _products$productInfo7, _products$productInfo8, _products$productInfo9, _productSubTotal$id;\n\n    console.log(products);\n    console.log(products.productInfo);\n    console.log(\"productTotalPrice\", productTotalPrice);\n    console.log(\"productSubTotal\", productSubTotal); // default value\n\n    var id = element.id;\n    var qty = (_products$productInfo = products === null || products === void 0 ? void 0 : (_products$productInfo2 = products.productInfo) === null || _products$productInfo2 === void 0 ? void 0 : (_products$productInfo3 = _products$productInfo2[id]) === null || _products$productInfo3 === void 0 ? void 0 : _products$productInfo3.qty) !== null && _products$productInfo !== void 0 ? _products$productInfo : 1;\n    var disc = (_products$productInfo4 = products === null || products === void 0 ? void 0 : (_products$productInfo5 = products.productInfo) === null || _products$productInfo5 === void 0 ? void 0 : (_products$productInfo6 = _products$productInfo5[id]) === null || _products$productInfo6 === void 0 ? void 0 : _products$productInfo6.disc) !== null && _products$productInfo4 !== void 0 ? _products$productInfo4 : 0;\n    var unit = (_products$productInfo7 = (_products$productInfo8 = products.productInfo) === null || _products$productInfo8 === void 0 ? void 0 : (_products$productInfo9 = _products$productInfo8[id]) === null || _products$productInfo9 === void 0 ? void 0 : _products$productInfo9.unit) !== null && _products$productInfo7 !== void 0 ? _products$productInfo7 : element.attributes.unit_1;\n    var unitPrice = getUnitPrice(element, unit);\n    var unitPriceAfterDisc = (_productSubTotal$id = productSubTotal === null || productSubTotal === void 0 ? void 0 : productSubTotal[id]) !== null && _productSubTotal$id !== void 0 ? _productSubTotal$id : element.attributes.buy_price_1;\n    var subTotal = unitPriceAfterDisc * qty;\n    console.log(qty, disc, unit, unitPrice, unitPriceAfterDisc, subTotal);\n    POSTPurchaseDetail(qty, disc, unit, unitPrice, unitPriceAfterDisc, subTotal, id, setListId, products, url);\n  });\n};\n\nvar POSTPurchaseDetail = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(qty, disc, unit, unitPrice, unitPriceAfterDisc, subTotal, id, setListId, products, url) {\n    var data, endpoint, JSONdata, options, req, res, _res$data;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            data = {\n              data: {\n                total_order: String(qty),\n                unit_order: unit,\n                unit_price: parseInt(unitPrice),\n                unit_price_after_disc: parseInt(unitPriceAfterDisc),\n                sub_total: parseInt(subTotal),\n                products: {\n                  id: id\n                },\n                disc: parseInt(disc)\n              }\n            };\n            endpoint = process.env.NEXT_PUBLIC_URL + url;\n            JSONdata = JSON.stringify(data);\n            options = {\n              method: \"POST\",\n              headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: \"Bearer \" + cookies.token\n              },\n              body: JSONdata\n            };\n            _context.next = 6;\n            return fetch(endpoint, options);\n\n          case 6:\n            req = _context.sent;\n            _context.next = 9;\n            return req.json();\n\n          case 9:\n            res = _context.sent;\n            console.log(data);\n            console.log(res);\n\n            if (req.status === 200) {\n              tempListId.push((_res$data = res.data) === null || _res$data === void 0 ? void 0 : _res$data.id);\n\n              if (tempListId.length === products.productList.length) {\n                setListId(tempListId);\n              }\n            }\n\n          case 13:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function POSTPurchaseDetail(_x, _x2, _x3, _x4, _x5, _x6, _x7, _x8, _x9, _x10) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nexport default createDetailOrder;","map":null,"metadata":{},"sourceType":"module"}