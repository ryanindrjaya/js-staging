{"ast":null,"code":"import _Progress from \"antd/lib/progress\";\nimport _defineProperty from \"/Users/yudiananta/Development/NextJS/ERP Dev/JS Deploy/ERP-Sejati/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"/Users/yudiananta/Development/NextJS/ERP Dev/JS Deploy/ERP-Sejati/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport _regeneratorRuntime from \"/Users/yudiananta/Development/NextJS/ERP Dev/JS Deploy/ERP-Sejati/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport React, { useEffect, useState } from \"react\";\nimport * as XLSX from \"xlsx\";\nimport { productKeys } from \"./utils/productKeys\";\nimport { getRelationalData, getLocationsId } from \"./utils/getRelationalData\";\nimport nookies from \"nookies\";\nimport { toast } from \"react-toastify\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport default function UploadProduk(_ref) {\n  var setProduct = _ref.setProduct;\n\n  var _useState = useState(false),\n      loading = _useState[0],\n      setLoading = _useState[1];\n\n  var _useState2 = useState(0),\n      percent = _useState2[0],\n      setPercent = _useState2[1];\n\n  var _useState3 = useState(null),\n      error = _useState3[0],\n      setError = _useState3[1];\n\n  var _useState4 = useState(\"\"),\n      status = _useState4[0],\n      setStatus = _useState4[1];\n\n  console.log(\"percent\", percent);\n\n  var postData = function postData(data) {\n    var increment = 100 / data.length;\n    console.log(\"increment\", increment);\n    var cookies = nookies.get(null);\n    var endpoint = process.env.NEXT_PUBLIC_URL + \"/products\";\n\n    try {\n      data.forEach( /*#__PURE__*/function () {\n        var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(row, idx) {\n          var data, options, req, res, endpointProduct, optionsAllProduct, reqProduct, resProduct;\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  data = {\n                    data: row\n                  };\n                  options = {\n                    method: \"POST\",\n                    headers: {\n                      \"Content-Type\": \"application/json\",\n                      Authorization: \"Bearer \" + cookies.token\n                    },\n                    body: JSON.stringify(data)\n                  };\n                  console.log(\"options\", options);\n                  _context.prev = 3;\n                  _context.next = 6;\n                  return fetch(endpoint, options);\n\n                case 6:\n                  req = _context.sent;\n                  _context.next = 9;\n                  return req.json();\n\n                case 9:\n                  res = _context.sent;\n                  setPercent(function (prev) {\n                    return Math.round(prev + increment);\n                  });\n\n                  if (!(req.status == 200)) {\n                    _context.next = 21;\n                    break;\n                  }\n\n                  endpointProduct = process.env.NEXT_PUBLIC_URL + \"/products?populate=*\";\n                  optionsAllProduct = {\n                    method: \"GET\",\n                    headers: {\n                      \"Content-Type\": \"application/json\",\n                      Authorization: \"Bearer \" + cookies.token\n                    }\n                  };\n                  _context.next = 16;\n                  return fetch(endpointProduct, optionsAllProduct);\n\n                case 16:\n                  reqProduct = _context.sent;\n                  _context.next = 19;\n                  return reqProduct.json();\n\n                case 19:\n                  resProduct = _context.sent;\n                  setProduct(resProduct);\n\n                case 21:\n                  _context.next = 26;\n                  break;\n\n                case 23:\n                  _context.prev = 23;\n                  _context.t0 = _context[\"catch\"](3);\n                  console.log(_context.t0);\n\n                case 26:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee, null, [[3, 23]]);\n        }));\n\n        return function (_x, _x2) {\n          return _ref2.apply(this, arguments);\n        };\n      }());\n    } catch (err) {\n      toast.error(\"Gagal mengunggah data\");\n      setLoading(false);\n    }\n  };\n\n  var convertToJson = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(data) {\n      var rows, resolvedRows;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              rows = data.map( /*#__PURE__*/function () {\n                var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(row) {\n                  var _rowData, _rowData$category, _rowData2, _rowData2$sub_categor, _rowData3, _rowData3$group, _rowData4, _rowData4$manufacture, _rowData5, _rowData5$locations;\n\n                  var rowData, categoryIdRaw, subCategoryIdRaw, groupAliasRaw, manufactureAliasRaw, locationNamesArrRaw, locationsNamesTrimmed, categoryId, subCategoryId, groupId, manufactureId, locationsId;\n                  return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                    while (1) {\n                      switch (_context2.prev = _context2.next) {\n                        case 0:\n                          rowData = {};\n                          row.forEach(function (element, index) {\n                            rowData[productKeys[index]] = element;\n                          });\n\n                          if (rowData.SKU) {\n                            _context2.next = 4;\n                            break;\n                          }\n\n                          return _context2.abrupt(\"return\");\n\n                        case 4:\n                          // process relational data\n                          categoryIdRaw = ((_rowData = rowData) === null || _rowData === void 0 ? void 0 : (_rowData$category = _rowData.category) === null || _rowData$category === void 0 ? void 0 : _rowData$category.split(\"-\")[0].trim()) || \"\";\n                          subCategoryIdRaw = ((_rowData2 = rowData) === null || _rowData2 === void 0 ? void 0 : (_rowData2$sub_categor = _rowData2.sub_category) === null || _rowData2$sub_categor === void 0 ? void 0 : _rowData2$sub_categor.split(\"-\")[0].trim()) || \"\";\n                          groupAliasRaw = ((_rowData3 = rowData) === null || _rowData3 === void 0 ? void 0 : (_rowData3$group = _rowData3.group) === null || _rowData3$group === void 0 ? void 0 : _rowData3$group.split(\"-\")[0].trim()) || \"\";\n                          manufactureAliasRaw = ((_rowData4 = rowData) === null || _rowData4 === void 0 ? void 0 : (_rowData4$manufacture = _rowData4.manufacture) === null || _rowData4$manufacture === void 0 ? void 0 : _rowData4$manufacture.split(\"-\")[0].trim()) || \"\";\n                          locationNamesArrRaw = ((_rowData5 = rowData) === null || _rowData5 === void 0 ? void 0 : (_rowData5$locations = _rowData5.locations) === null || _rowData5$locations === void 0 ? void 0 : _rowData5$locations.split(\",\")) || [];\n                          locationsNamesTrimmed = locationNamesArrRaw.map(function (item) {\n                            return item === null || item === void 0 ? void 0 : item.trim();\n                          });\n                          console.log(\"manufacture alias\", manufactureAliasRaw);\n                          _context2.next = 13;\n                          return getRelationalData(\"categories\", \"category_id\", categoryIdRaw);\n\n                        case 13:\n                          categoryId = _context2.sent;\n                          _context2.next = 16;\n                          return getRelationalData(\"sub-categories\", \"sub_id\", subCategoryIdRaw);\n\n                        case 16:\n                          subCategoryId = _context2.sent;\n                          _context2.next = 19;\n                          return getRelationalData(\"groups\", \"alias\", groupAliasRaw);\n\n                        case 19:\n                          groupId = _context2.sent;\n                          _context2.next = 22;\n                          return getRelationalData(\"manufactures\", \"code\", manufactureAliasRaw);\n\n                        case 22:\n                          manufactureId = _context2.sent;\n                          _context2.next = 25;\n                          return getLocationsId(locationsNamesTrimmed);\n\n                        case 25:\n                          locationsId = _context2.sent;\n                          rowData = _objectSpread(_objectSpread({}, rowData), {}, {\n                            category: categoryId,\n                            sub_category: subCategoryId,\n                            group: groupId,\n                            manufacture: manufactureId,\n                            locations: locationsId\n                          });\n                          return _context2.abrupt(\"return\", rowData);\n\n                        case 28:\n                        case \"end\":\n                          return _context2.stop();\n                      }\n                    }\n                  }, _callee2);\n                }));\n\n                return function (_x4) {\n                  return _ref4.apply(this, arguments);\n                };\n              }());\n              _context3.next = 3;\n              return Promise.all(rows);\n\n            case 3:\n              resolvedRows = _context3.sent;\n              return _context3.abrupt(\"return\", resolvedRows);\n\n            case 5:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function convertToJson(_x3) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var importExcel = function importExcel(e) {\n    setLoading(true);\n    console.log(e.target.files);\n\n    try {\n      var file = e.target.files[0];\n      var reader = new FileReader();\n\n      reader.onload = /*#__PURE__*/function () {\n        var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(event) {\n          var bstr, workbook, workSheetName, workSheet, fileData, rowsData;\n          return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n            while (1) {\n              switch (_context4.prev = _context4.next) {\n                case 0:\n                  bstr = event.target.result;\n                  workbook = XLSX.read(bstr, {\n                    type: \"binary\"\n                  });\n                  workSheetName = workbook.SheetNames[0];\n                  workSheet = workbook.Sheets[workSheetName];\n                  fileData = XLSX.utils.sheet_to_json(workSheet, {\n                    header: 1\n                  });\n                  fileData.splice(0, 2);\n                  _context4.next = 8;\n                  return convertToJson(fileData);\n\n                case 8:\n                  rowsData = _context4.sent;\n                  postData(rowsData);\n\n                case 10:\n                case \"end\":\n                  return _context4.stop();\n              }\n            }\n          }, _callee4);\n        }));\n\n        return function (_x5) {\n          return _ref5.apply(this, arguments);\n        };\n      }();\n\n      reader.readAsBinaryString(file);\n    } catch (err) {\n      setError(\"gagal ges ges\");\n      setLoading(false);\n    }\n  };\n\n  useEffect(function () {\n    if (percent >= 100) {\n      toast.success(\"Berhasil mengunggah data\");\n      setLoading(false);\n      setPercent(0);\n    }\n  }, [percent]);\n  useEffect(function () {\n    if (error !== null) {\n      toast.error(error);\n      setTimeout(function () {\n        setError(null);\n      }, 2000);\n    }\n  }, [error]);\n  return loading ? /*#__PURE__*/_jsx(\"div\", {\n    className: \"flex flex-col items-center justify-center w-full\",\n    children: /*#__PURE__*/_jsx(_Progress, {\n      type: \"circle\",\n      width: 35,\n      percent: percent,\n      status: status\n    })\n  }) : /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsx(\"label\", {\n      htmlFor: \"upload_file\",\n      className: \"bg-cyan-700 cursor-pointer text-xs font-bold text-white w-full rounded h-10 hover:bg-cyan-800  shadow-sm flex items-center justify-center float-right\",\n      children: \"Upload\"\n    }), /*#__PURE__*/_jsx(\"input\", {\n      onChange: importExcel,\n      type: \"file\",\n      id: \"upload_file\",\n      hidden: true\n    })]\n  });\n}","map":null,"metadata":{},"sourceType":"module"}