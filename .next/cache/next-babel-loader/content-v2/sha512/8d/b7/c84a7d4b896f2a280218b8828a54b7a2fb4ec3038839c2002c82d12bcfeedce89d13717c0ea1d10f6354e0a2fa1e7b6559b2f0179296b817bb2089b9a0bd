{"ast":null,"code":"import _Alert from \"antd/lib/alert\";\nimport _Spin from \"antd/lib/spin\";\nvar _jsxFileName = \"/Users/yudiananta/Development/NextJS/ERP Dev/JS Deploy/ERP-Sejati/pages/signin.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useState } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useRouter } from \"next/router\";\nimport Input from \"@iso/components/uielements/input\";\nimport Button from \"@iso/components/uielements/button\";\nimport IntlMessages from \"@iso/components/utility/intlMessages\";\nimport authActions from \"../authentication/actions\";\nimport SignInStyleWrapper from \"../styled/SignIn.styles\";\nimport nookies from \"nookies\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst {\n  login\n} = authActions;\nexport default function SignInPage(props) {\n  const dispatch = useDispatch();\n  const router = useRouter();\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(false);\n  const {\n    0: failedLogin,\n    1: setFailedLogin\n  } = useState(false);\n  const {\n    0: failedLoginMsg,\n    1: setfailedLoginMsg\n  } = useState(\"Username atau Password salah\");\n  const {\n    0: field,\n    1: setField\n  } = useState({});\n\n  const handleLogin = async e => {\n    e.preventDefault();\n    setFailedLogin(false);\n    setLoading(true);\n    const credentials = {\n      identifier: field.username,\n      password: field.password\n    };\n    const JSONdata = JSON.stringify(credentials);\n    const endpoint = process.env.NEXT_PUBLIC_URL + \"/auth/local\";\n    const options = {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSONdata\n    };\n\n    try {\n      const req = await fetch(endpoint, options);\n      const res = await req.json();\n\n      if (res.jwt) {\n        // set new token\n        nookies.set(null, \"token\", res.jwt, {\n          maxAge: 30 * 24 * 60 * 60,\n          path: \"/\",\n          secure: process.env.NEXT_PUBLIC_URL !== \"development\",\n          sameSite: \"strict\"\n        });\n        const role = await getUserInformation(res.jwt); // set role token\n\n        nookies.set(null, \"role\", role, {\n          maxAge: 30 * 24 * 60 * 60,\n          path: \"/\",\n          secure: process.env.NEXT_PUBLIC_URL !== \"development\",\n          sameSite: \"strict\"\n        }); // redirect\n\n        router.replace(\"/dashboard\");\n      } else {\n        setFailedLogin(true);\n      }\n    } catch (error) {\n      setFailedLogin(true);\n      setfailedLoginMsg(\"Kesalahan Pada Server. Silahkan cek kembali\");\n    }\n\n    setLoading(false);\n  };\n\n  const getUserInformation = async jwt => {\n    const endpoint = process.env.NEXT_PUBLIC_URL + \"/users/me?populate=role\";\n    const options = {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + jwt\n      }\n    };\n    const req = await fetch(endpoint, options);\n    const res = await req.json();\n    console.log(res);\n    return res.role.name;\n  };\n\n  const onClose = e => {\n    console.log(e, \"I was closed.\");\n  };\n\n  function setValue(e) {\n    const target = e.target;\n    const name = target.name;\n    const value = target.value;\n    setField(_objectSpread(_objectSpread({}, field), {}, {\n      [name]: value\n    }));\n  } // =========================== UI ===========================\n\n\n  return /*#__PURE__*/_jsxDEV(SignInStyleWrapper, {\n    className: \"isoSignInPage\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"isoLoginContentWrapper\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"isoLoginContent\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"isoLogoWrapper\",\n          children: \"JAYA SEHAT\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 116,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"isoSignInForm\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"isoInputWrapper\",\n            children: /*#__PURE__*/_jsxDEV(Input, {\n              onChange: setValue,\n              name: \"username\",\n              id: \"inputUserName\",\n              size: \"large\",\n              placeholder: \"Username\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 120,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 119,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"isoInputWrapper\",\n            children: /*#__PURE__*/_jsxDEV(Input, {\n              onChange: setValue,\n              id: \"inpuPassword\",\n              size: \"large\",\n              name: \"password\",\n              type: \"password\",\n              placeholder: \"Password\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 124,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 123,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"isoInputWrapper isoLeftRightComponent\",\n            children: loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"center\",\n              children: /*#__PURE__*/_jsxDEV(_Spin, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 130,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 129,\n              columnNumber: 17\n            }, this) : /*#__PURE__*/_jsxDEV(Button, {\n              type: \"primary\",\n              onClick: handleLogin,\n              children: /*#__PURE__*/_jsxDEV(IntlMessages, {\n                id: \"page.signInButton\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 134,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 133,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 127,\n            columnNumber: 13\n          }, this), failedLogin ? /*#__PURE__*/_jsxDEV(_Alert, {\n            message: \"Login Error\",\n            description: \"Username atau Password salah\",\n            type: \"error\",\n            closable: true,\n            onClose: onClose\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 139,\n            columnNumber: 15\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 141,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 113,\n    columnNumber: 5\n  }, this);\n}","map":{"version":3,"sources":["/Users/yudiananta/Development/NextJS/ERP Dev/JS Deploy/ERP-Sejati/pages/signin.js"],"names":["React","useState","useDispatch","useRouter","Input","Button","IntlMessages","authActions","SignInStyleWrapper","nookies","login","SignInPage","props","dispatch","router","loading","setLoading","failedLogin","setFailedLogin","failedLoginMsg","setfailedLoginMsg","field","setField","handleLogin","e","preventDefault","credentials","identifier","username","password","JSONdata","JSON","stringify","endpoint","process","env","NEXT_PUBLIC_URL","options","method","headers","body","req","fetch","res","json","jwt","set","maxAge","path","secure","sameSite","role","getUserInformation","replace","error","Authorization","console","log","name","onClose","setValue","target","value"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useRouter } from \"next/router\";\nimport Input from \"@iso/components/uielements/input\";\nimport Button from \"@iso/components/uielements/button\";\nimport IntlMessages from \"@iso/components/utility/intlMessages\";\nimport authActions from \"../authentication/actions\";\nimport SignInStyleWrapper from \"../styled/SignIn.styles\";\nimport { Spin, Alert } from \"antd\";\nimport nookies from \"nookies\";\n\nconst { login } = authActions;\n\nexport default function SignInPage(props) {\n  const dispatch = useDispatch();\n  const router = useRouter();\n  const [loading, setLoading] = useState(false);\n  const [failedLogin, setFailedLogin] = useState(false);\n  const [failedLoginMsg, setfailedLoginMsg] = useState(\"Username atau Password salah\");\n  const [field, setField] = useState({});\n\n  const handleLogin = async (e) => {\n    e.preventDefault();\n    setFailedLogin(false);\n    setLoading(true);\n\n    const credentials = {\n      identifier: field.username,\n      password: field.password,\n    };\n\n    const JSONdata = JSON.stringify(credentials);\n    const endpoint = process.env.NEXT_PUBLIC_URL + \"/auth/local\";\n\n    const options = {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSONdata,\n    };\n\n    try {\n      const req = await fetch(endpoint, options);\n      const res = await req.json();\n\n      if (res.jwt) {\n        // set new token\n        nookies.set(null, \"token\", res.jwt, {\n          maxAge: 30 * 24 * 60 * 60,\n          path: \"/\",\n          secure: process.env.NEXT_PUBLIC_URL !== \"development\",\n          sameSite: \"strict\",\n        });\n\n        const role = await getUserInformation(res.jwt);\n        // set role token\n        nookies.set(null, \"role\", role, {\n          maxAge: 30 * 24 * 60 * 60,\n          path: \"/\",\n          secure: process.env.NEXT_PUBLIC_URL !== \"development\",\n          sameSite: \"strict\",\n        });\n\n        // redirect\n        router.replace(\"/dashboard\");\n      } else {\n        setFailedLogin(true);\n      }\n    } catch (error) {\n      setFailedLogin(true);\n      setfailedLoginMsg(\"Kesalahan Pada Server. Silahkan cek kembali\");\n    }\n\n    setLoading(false);\n  };\n\n  const getUserInformation = async (jwt) => {\n    const endpoint = process.env.NEXT_PUBLIC_URL + \"/users/me?populate=role\";\n\n    const options = {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + jwt,\n      },\n    };\n\n    const req = await fetch(endpoint, options);\n    const res = await req.json();\n    console.log(res);\n    return res.role.name;\n  };\n\n  const onClose = (e) => {\n    console.log(e, \"I was closed.\");\n  };\n\n  function setValue(e) {\n    const target = e.target;\n    const name = target.name;\n    const value = target.value;\n\n    setField({\n      ...field,\n      [name]: value,\n    });\n  }\n\n  // =========================== UI ===========================\n\n  return (\n    <SignInStyleWrapper className=\"isoSignInPage\">\n      <div className=\"isoLoginContentWrapper\">\n        <div className=\"isoLoginContent\">\n          <div className=\"isoLogoWrapper\">JAYA SEHAT</div>\n\n          <div className=\"isoSignInForm\">\n            <div className=\"isoInputWrapper\">\n              <Input onChange={setValue} name=\"username\" id=\"inputUserName\" size=\"large\" placeholder=\"Username\" />\n            </div>\n\n            <div className=\"isoInputWrapper\">\n              <Input onChange={setValue} id=\"inpuPassword\" size=\"large\" name=\"password\" type=\"password\" placeholder=\"Password\" />\n            </div>\n\n            <div className=\"isoInputWrapper isoLeftRightComponent\">\n              {loading ? (\n                <div className=\"center\">\n                  <Spin />\n                </div>\n              ) : (\n                <Button type=\"primary\" onClick={handleLogin}>\n                  <IntlMessages id=\"page.signInButton\" />\n                </Button>\n              )}\n            </div>\n            {failedLogin ? (\n              <Alert message=\"Login Error\" description=\"Username atau Password salah\" type=\"error\" closable onClose={onClose} />\n            ) : (\n              <div></div>\n            )}\n          </div>\n        </div>\n      </div>\n    </SignInStyleWrapper>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}