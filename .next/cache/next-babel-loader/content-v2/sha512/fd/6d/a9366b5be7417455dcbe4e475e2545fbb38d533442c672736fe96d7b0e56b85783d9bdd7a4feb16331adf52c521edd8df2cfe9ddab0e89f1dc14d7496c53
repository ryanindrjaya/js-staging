{"ast":null,"code":"import _Button from \"antd/lib/button\";\nimport _Spin from \"antd/lib/spin\";\nimport _Select from \"antd/lib/select\";\nimport _MailOutlined from \"@ant-design/icons/lib/icons/MailOutlined\";\nimport _Input from \"antd/lib/input\";\nimport _UserOutlined from \"@ant-design/icons/lib/icons/UserOutlined\";\nimport _defineProperty from \"/Users/yudiananta/Development/NextJS/ERP Dev/JS Deploy/ERP-Sejati/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"/Users/yudiananta/Development/NextJS/ERP Dev/JS Deploy/ERP-Sejati/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _Form from \"antd/lib/form\";\nimport _slicedToArray from \"/Users/yudiananta/Development/NextJS/ERP Dev/JS Deploy/ERP-Sejati/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _regeneratorRuntime from \"/Users/yudiananta/Development/NextJS/ERP Dev/JS Deploy/ERP-Sejati/node_modules/next/node_modules/@babel/runtime/regenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport nookies from \"nookies\";\nimport { useState } from \"react\";\nimport Head from \"next/head\";\nimport LayoutContent from \"@iso/components/utility/layoutContent\";\nimport DashboardLayout from \"../../../../containers/DashboardLayout/DashboardLayout\";\nimport LayoutWrapper from \"@iso/components/utility/layoutWrapper.js\";\nimport TitlePage from \"../../../../components/TitlePage/TitlePage\";\nimport { toast } from \"react-toastify\";\nimport { useRouter } from \"next/router\";\nimport Locations from \"../../../../components/Form/Locations\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\n\nvar Edit = function Edit(_ref) {\n  var _props$role;\n\n  var props = _ref.props;\n\n  var _Form$useForm = _Form.useForm(),\n      _Form$useForm2 = _slicedToArray(_Form$useForm, 1),\n      form = _Form$useForm2[0];\n\n  var _useState = useState(false),\n      loading = _useState[0],\n      setLoading = _useState[1];\n\n  var _useState2 = useState({}),\n      selectLocations = _useState2[0],\n      setSelectLocation = _useState2[1];\n\n  var cookies = nookies.get(null, \"token\");\n  var router = useRouter();\n  var role = props === null || props === void 0 ? void 0 : (_props$role = props.role) === null || _props$role === void 0 ? void 0 : _props$role.roles;\n  var user = props === null || props === void 0 ? void 0 : props.user;\n  var userRole = props === null || props === void 0 ? void 0 : props.user.role;\n  var userLocation = props === null || props === void 0 ? void 0 : props.user.locations;\n  var locations = props === null || props === void 0 ? void 0 : props.locations;\n\n  var onFinish = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(values) {\n      var role, data, endpoint, JSONdata, options, req, res, _res$error;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              setLoading(true);\n              _context.next = 3;\n              return getRole(values.role_id);\n\n            case 3:\n              role = _context.sent;\n              data = _objectSpread(_objectSpread({}, values), {}, {\n                role: role,\n                deleteAble: true\n              });\n              endpoint = process.env.NEXT_PUBLIC_URL + \"/users/\" + user.id;\n              JSONdata = JSON.stringify(data);\n              options = {\n                method: \"PUT\",\n                headers: {\n                  \"Content-Type\": \"application/json\",\n                  Authorization: \"Bearer \" + cookies.token\n                },\n                body: JSONdata\n              };\n              _context.next = 10;\n              return fetch(endpoint, options);\n\n            case 10:\n              req = _context.sent;\n              _context.next = 13;\n              return req.json();\n\n            case 13:\n              res = _context.sent;\n\n              if (req.status === 200) {\n                router.back();\n                toast.success(\"Data Pengguna berhasil diperbarui!\", {\n                  position: toast.POSITION.TOP_RIGHT\n                });\n              } else {\n                (_res$error = res.error) === null || _res$error === void 0 ? void 0 : _res$error.details.errors.map(function (error) {\n                  toast.error(\"Tidak dapat memperbarui Pengguna\", {\n                    position: toast.POSITION.TOP_RIGHT\n                  });\n                });\n              }\n\n              setLoading(false);\n\n            case 16:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function onFinish(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var getRole = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(roleId) {\n      var endpoint, options, req, res;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              endpoint = process.env.NEXT_PUBLIC_URL + \"/users-permissions/roles/\" + roleId;\n              options = {\n                method: \"GET\",\n                headers: {\n                  \"Content-Type\": \"application/json\",\n                  Authorization: \"Bearer \" + cookies.token\n                }\n              };\n              _context2.next = 4;\n              return fetch(endpoint, options);\n\n            case 4:\n              req = _context2.sent;\n              _context2.next = 7;\n              return req.json();\n\n            case 7:\n              res = _context2.sent;\n              return _context2.abrupt(\"return\", res.role);\n\n            case 9:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function getRole(_x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsx(Head, {\n      children: /*#__PURE__*/_jsx(\"title\", {\n        children: \"Tambahkan Pengguna\"\n      })\n    }), /*#__PURE__*/_jsx(DashboardLayout, {\n      children: /*#__PURE__*/_jsxs(LayoutWrapper, {\n        style: {},\n        children: [/*#__PURE__*/_jsx(TitlePage, {\n          titleText: \"Tambahkan Pengguna\"\n        }), /*#__PURE__*/_jsx(LayoutContent, {\n          children: /*#__PURE__*/_jsxs(_Form, {\n            form: form,\n            name: \"add_user\",\n            initialValues: {\n              remember: true\n            },\n            onFinish: onFinish,\n            children: [/*#__PURE__*/_jsxs(\"div\", {\n              className: \"flex flex-wrap -mx-3 mb-6\",\n              children: [/*#__PURE__*/_jsx(\"div\", {\n                className: \"w-full md:w-1/3 px-3 mb-2 md:mb-0\",\n                children: /*#__PURE__*/_jsx(_Form.Item, {\n                  initialValue: user.username,\n                  name: \"username\",\n                  rules: [{\n                    required: true,\n                    message: \"Username tidak boleh kosong!\"\n                  }],\n                  children: /*#__PURE__*/_jsx(_Input, {\n                    disabled: true,\n                    style: {\n                      height: \"50px\"\n                    },\n                    prefix: /*#__PURE__*/_jsx(_UserOutlined, {\n                      style: {\n                        fontSize: \"150%\"\n                      },\n                      className: \"site-form-item-icon mr-5\"\n                    }),\n                    placeholder: \"Username\"\n                  })\n                })\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: \"w-full md:w-1/3 px-3 mb-2 md:mb-0\",\n                children: /*#__PURE__*/_jsx(_Form.Item, {\n                  initialValue: user.name,\n                  name: \"name\",\n                  rules: [{\n                    required: true,\n                    message: \"Nama tidak boleh kosong!\"\n                  }],\n                  children: /*#__PURE__*/_jsx(_Input, {\n                    style: {\n                      height: \"50px\"\n                    },\n                    prefix: /*#__PURE__*/_jsx(_UserOutlined, {\n                      style: {\n                        fontSize: \"150%\"\n                      },\n                      className: \"site-form-item-icon mr-5\"\n                    }),\n                    placeholder: \"Nama\"\n                  })\n                })\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: \"w-full md:w-1/3 px-3 mb-2 md:mb-0\",\n                children: /*#__PURE__*/_jsx(_Form.Item, {\n                  name: \"email\",\n                  initialValue: user.email,\n                  rules: [{\n                    required: true,\n                    message: \"Email tidak boleh kosong!\"\n                  }],\n                  children: /*#__PURE__*/_jsx(_Input, {\n                    style: {\n                      height: \"50px\"\n                    },\n                    prefix: /*#__PURE__*/_jsx(_MailOutlined, {\n                      style: {\n                        fontSize: \"150%\"\n                      },\n                      className: \"site-form-item-icon mr-5\"\n                    }),\n                    placeholder: \"Email\"\n                  })\n                })\n              })]\n            }), /*#__PURE__*/_jsx(Locations, {\n              data: locations,\n              onSelect: setSelectLocation,\n              initialValue: userLocation,\n              errMsg: \"Harap pilih lokasi user\",\n              required: true\n            }), /*#__PURE__*/_jsx(_Form.Item, {\n              name: \"role_id\",\n              className: \"w-1/4 mb-5 ml-1\",\n              initialValue: userRole.id,\n              children: /*#__PURE__*/_jsx(_Select, {\n                placeholder: \"Role\",\n                children: role.map(function (role) {\n                  return role.name === \"Authenticated\" || role.name === \"Public\" ? /*#__PURE__*/_jsx(_Select.Option, {\n                    hidden: true,\n                    disabled: true,\n                    value: role.id,\n                    children: role.name\n                  }) : /*#__PURE__*/_jsx(_Select.Option, {\n                    value: role.id,\n                    children: role.name\n                  });\n                })\n              })\n            }), /*#__PURE__*/_jsx(_Form.Item, {\n              children: loading ? /*#__PURE__*/_jsx(\"div\", {\n                className: \" flex float-left ml-3\",\n                children: /*#__PURE__*/_jsx(_Spin, {})\n              }) : /*#__PURE__*/_jsx(_Button, {\n                htmlType: \"submit\",\n                className: \" hover:text-white hover:bg-cyan-700 border border-cyan-700 ml-1\",\n                children: \"Submit\"\n              })\n            })]\n          })\n        })]\n      })\n    })]\n  });\n};\n\nEdit.getInitialProps = /*#__PURE__*/function () {\n  var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(context) {\n    var cookies, id, endpoint, options, res, user, resRole, role, reqLocations, resLocations;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            cookies = nookies.get(context);\n            id = context.query.id;\n            endpoint = process.env.NEXT_PUBLIC_URL + \"/users/\" + id + \"?populate=*\";\n            options = {\n              method: \"GET\",\n              headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: \"Bearer \" + cookies.token\n              }\n            };\n            _context3.next = 6;\n            return fetch(endpoint, options);\n\n          case 6:\n            res = _context3.sent;\n            _context3.next = 9;\n            return res.json();\n\n          case 9:\n            user = _context3.sent;\n            _context3.next = 12;\n            return fetchRole(cookies);\n\n          case 12:\n            resRole = _context3.sent;\n            _context3.next = 15;\n            return resRole.json();\n\n          case 15:\n            role = _context3.sent;\n            _context3.next = 18;\n            return fetchDataLocation(cookies, \"/locations\");\n\n          case 18:\n            reqLocations = _context3.sent;\n            _context3.next = 21;\n            return reqLocations.json();\n\n          case 21:\n            resLocations = _context3.sent;\n            return _context3.abrupt(\"return\", {\n              props: {\n                user: user,\n                role: role,\n                locations: resLocations\n              }\n            });\n\n          case 23:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n\n  return function (_x3) {\n    return _ref4.apply(this, arguments);\n  };\n}();\n\nvar fetchRole = /*#__PURE__*/function () {\n  var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(cookies) {\n    var endpoint, options, req;\n    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            endpoint = process.env.NEXT_PUBLIC_URL + \"/users-permissions/roles\";\n            options = {\n              method: \"GET\",\n              headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: \"Bearer \" + cookies.token\n              }\n            };\n            _context4.next = 4;\n            return fetch(endpoint, options);\n\n          case 4:\n            req = _context4.sent;\n            return _context4.abrupt(\"return\", req);\n\n          case 6:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4);\n  }));\n\n  return function fetchRole(_x4) {\n    return _ref5.apply(this, arguments);\n  };\n}();\n\nvar fetchDataLocation = /*#__PURE__*/function () {\n  var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(cookies, url) {\n    var endpoint, options, req;\n    return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            endpoint = process.env.NEXT_PUBLIC_URL + url;\n            options = {\n              method: \"GET\",\n              headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: \"Bearer \" + cookies.token\n              }\n            };\n            _context5.next = 4;\n            return fetch(endpoint, options);\n\n          case 4:\n            req = _context5.sent;\n            return _context5.abrupt(\"return\", req);\n\n          case 6:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee5);\n  }));\n\n  return function fetchDataLocation(_x5, _x6) {\n    return _ref6.apply(this, arguments);\n  };\n}();\n\nexport default Edit;","map":null,"metadata":{},"sourceType":"module"}