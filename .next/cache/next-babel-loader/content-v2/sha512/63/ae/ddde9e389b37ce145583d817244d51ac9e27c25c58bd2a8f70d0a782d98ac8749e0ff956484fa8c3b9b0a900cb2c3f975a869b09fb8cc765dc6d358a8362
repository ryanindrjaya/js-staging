{"ast":null,"code":"import _Modal from \"antd/lib/modal\";\nimport _Select from \"antd/lib/select\";\nimport _Input from \"antd/lib/input\";\nvar _jsxFileName = \"/Users/yudiananta/Development/NextJS/ERP Dev/JS Deploy/ERP-Sejati/pages/dashboard/produk/index.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport Head from \"next/head\";\nimport React, { useEffect, useState } from \"react\";\nimport LayoutContent from \"@iso/components/utility/layoutContent\";\nimport LayoutWrapper from \"@iso/components/utility/layoutWrapper.js\";\nimport { useRouter } from \"next/router\";\nimport { toast } from \"react-toastify\";\nimport nookies from \"nookies\";\nimport DashboardLayout from \"../../../containers/DashboardLayout/DashboardLayout\";\nimport TitlePage from \"../../../components/TitlePage/TitlePage\";\nimport ProductTable from \"../../../components/ReactDataTable/ProductTable\";\nimport ProductModal from \"../../../components/Modal/ProductModal\";\nimport UnitTableView from \"../../../components/ReactDataTable/Product/UnitsTableView\";\nimport Manufactures from \"../../../components/Form/AddProduct/Manufactures\";\nimport DownloadTemplate from \"../../../components/Form/DownloadTemplate\";\nimport ExportProduk from \"../../../components/Form/ExportProduk\";\nimport UploadProduk from \"../../../components/Form/UploadProduk\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst Product = ({\n  props\n}) => {\n  const data = props.data;\n  const manufactures = props.manufactures;\n  const categories = props.categories;\n  const locations = props.locations;\n  const {\n    0: isLoading,\n    1: setIsLoading\n  } = useState(false);\n  const {\n    0: product,\n    1: setProduct\n  } = useState(data);\n  const {\n    0: modalProduct,\n    1: setModalProduct\n  } = useState();\n  const {\n    0: isSearching,\n    1: setIsSearching\n  } = useState(false);\n  const {\n    0: visible,\n    1: setVisible\n  } = useState(false);\n  const router = useRouter();\n  const {\n    0: inventory,\n    1: setInventory\n  } = useState();\n  const {\n    0: searchParameters,\n    1: setSearchParameters\n  } = useState({\n    namaSKU: \"\",\n    manufacture: \"\",\n    location: [],\n    category: \"\"\n  });\n  const {\n    0: searchOptionData,\n    1: setSearchOptionData\n  } = useState({\n    manufactures: manufactures,\n    categories: categories,\n    locations: locations\n  });\n  const {\n    Search\n  } = _Input;\n\n  const handleSearch = (newValue, category) => {\n    if (newValue) {\n      fetchSearchOption(newValue, category);\n    } else {\n      setSearchOptionData({\n        manufactures: manufactures,\n        categories: categories,\n        locations: locations\n      });\n    }\n  };\n\n  const fetchSearchOption = async (query, category) => {\n    const cookies = nookies.get(null);\n\n    try {\n      const endpoint = process.env.NEXT_PUBLIC_URL + `/${category}?filters[name][$containsi]=${query}`;\n      const options = {\n        method: \"GET\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: \"Bearer \" + cookies.token\n        }\n      };\n      const req = await fetch(endpoint, options);\n      const res = await req.json();\n\n      if (req.status == 200) {\n        const resData = res.data.map(item => ({\n          name: `${item.attributes.name}`,\n          value: item.id,\n          id: item.id\n        }));\n        setSearchOptionData(_objectSpread(_objectSpread({}, searchOptionData), {}, {\n          [category]: resData\n        }));\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  }; // search query\n\n\n  useEffect(() => {\n    const searchQuery = async () => {\n      setIsSearching(true);\n      var query = \"filters[$or][0][name][$contains]=\" + searchParameters.namaSKU + \"&filters[$or][1][SKU][$contains]=\" + searchParameters.namaSKU;\n      var locationQuery = \"\";\n\n      if (searchParameters.manufacture) {\n        query += \"&filters[$and][2][manufacture][id][$eq]=\";\n        query += searchParameters.manufacture;\n      }\n\n      if (searchParameters.category) {\n        query += \"&filters[$and][3][category][id][$eq]=\";\n        query += searchParameters.category;\n      }\n\n      if (searchParameters.location.length > 0) {\n        searchParameters.location.forEach((item, idx) => {\n          locationQuery += \"&filters[$and][\" + (idx + 4) + \"][locations][id][$eq]=\" + item;\n        });\n      } else {\n        locationQuery = \"\";\n      }\n\n      const endpoint = process.env.NEXT_PUBLIC_URL + \"/products?populate=*&\" + query + locationQuery;\n      const cookies = nookies.get(null, \"token\");\n      const options = {\n        method: \"GET\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: \"Bearer \" + cookies.token\n        }\n      };\n      const req = await fetch(endpoint, options);\n      const res = await req.json();\n      setProduct(res);\n      setIsSearching(false);\n    };\n\n    searchQuery();\n  }, [searchParameters]);\n\n  const handleAdd = () => {\n    console.log(\"\");\n    router.push(\"/dashboard/produk/tambah\");\n  };\n\n  const handleView = () => {\n    router.push(\"/dashboard/produk/lihat\");\n  };\n\n  const handleUpdate = id => {\n    console.log(\"\");\n    router.push(\"/dashboard/produk/edit/\" + id);\n  };\n\n  const handleDelete = async id => {\n    const endpoint = process.env.NEXT_PUBLIC_URL + \"/products/\" + id;\n    const cookies = nookies.get(null, \"token\");\n    const options = {\n      method: \"DELETE\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + cookies.token\n      }\n    };\n    const req = await fetch(endpoint, options);\n    const res = await req.json();\n\n    if (res) {\n      const req = await fetchData(cookies);\n      const res = await req.json();\n      toast.success(\"Produk berhasil dihapus\");\n      setProduct(res);\n    }\n  };\n\n  const handlePageChange = async page => {\n    const cookies = nookies.get(null, \"token\");\n    const endpoint = process.env.NEXT_PUBLIC_URL + \"/products?pagination[page]=\" + page;\n    const options = {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + cookies.token\n      }\n    };\n\n    try {\n      const req = await fetch(endpoint, options);\n      const res = await req.json();\n\n      if (res) {\n        setProduct(prevData => ({\n          data: filterDuplicateData(prevData.data.concat(res.data)),\n          meta: prevData.meta\n        }));\n      } else {\n        console.log(\"something is wrong\");\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const filterDuplicateData = arr => {\n    const seen = new Set();\n    const filteredArr = arr.filter(el => {\n      const duplicate = seen.has(el.id);\n      seen.add(el.id);\n      return !duplicate;\n    });\n    return filteredArr;\n  };\n\n  const fetchInventory = async data => {\n    setIsLoading(true);\n    const cookies = nookies.get(null, \"token\");\n    const endpoint = process.env.NEXT_PUBLIC_URL + `/inventories?filters[products][id][$eq]=${data.id}&populate=locations`;\n    const options = {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + cookies.token\n      }\n    };\n    const req = await fetch(endpoint, options);\n    const res = await req.json(); // return req;\n    // console.log(res);\n\n    setInventory(res.data); //\n  };\n\n  const openModal = async (e, data) => {\n    // console.log(\"test\", data);\n    setVisible(e);\n    fetchInventory(data);\n  };\n\n  useEffect(() => {\n    console.log(\"inventory\", inventory);\n    setIsLoading(false);\n  }, [inventory]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Head, {\n      children: /*#__PURE__*/_jsxDEV(\"title\", {\n        children: \"Produk\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 257,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(DashboardLayout, {\n      children: /*#__PURE__*/_jsxDEV(LayoutWrapper, {\n        style: {},\n        children: [/*#__PURE__*/_jsxDEV(TitlePage, {\n          titleText: \"Produk\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 261,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(LayoutContent, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"w-full flex justify-between gap-x-32 mb-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"w-full md:w-1/2 grid grid-cols-2 gap-x-4 gap-y-3\",\n              children: [/*#__PURE__*/_jsxDEV(_Select, {\n                size: \"middle\",\n                allowClear: true,\n                showSearch: true,\n                showArrow: false,\n                filterOption: false,\n                notFoundContent: null,\n                placeholder: \"PABRIKASI\",\n                onSelect: e => setSearchParameters(_objectSpread(_objectSpread({}, searchParameters), {}, {\n                  manufacture: e\n                })),\n                onClear: () => setSearchParameters(_objectSpread(_objectSpread({}, searchParameters), {}, {\n                  manufacture: \"\"\n                })),\n                onSearch: e => handleSearch(e, \"manufactures\"),\n                children: searchOptionData.manufactures.map(item => /*#__PURE__*/_jsxDEV(_Select.Option, {\n                  value: item === null || item === void 0 ? void 0 : item.id,\n                  children: item.name\n                }, item === null || item === void 0 ? void 0 : item.id, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 285,\n                  columnNumber: 21\n                }, this))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 265,\n                columnNumber: 17\n              }, this), \" \", /*#__PURE__*/_jsxDEV(_Select, {\n                size: \"middle\",\n                allowClear: true,\n                showSearch: true,\n                showArrow: false,\n                filterOption: false,\n                notFoundContent: null,\n                placeholder: \"KATEGORI\",\n                onSelect: e => setSearchParameters(_objectSpread(_objectSpread({}, searchParameters), {}, {\n                  category: e\n                })),\n                onClear: () => setSearchParameters(_objectSpread(_objectSpread({}, searchParameters), {}, {\n                  category: \"\"\n                })),\n                onSearch: e => handleSearch(e, \"categories\"),\n                children: searchOptionData.categories.map(item => /*#__PURE__*/_jsxDEV(_Select.Option, {\n                  value: item === null || item === void 0 ? void 0 : item.id,\n                  children: item.name\n                }, item === null || item === void 0 ? void 0 : item.id, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 307,\n                  columnNumber: 21\n                }, this))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 290,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(_Select, {\n                mode: \"multiple\",\n                size: \"middle\",\n                placeholder: \"LOKASI\",\n                allowClear: true,\n                onChange: e => setSearchParameters(_objectSpread(_objectSpread({}, searchParameters), {}, {\n                  location: e\n                })),\n                onClear: () => setSearchParameters(_objectSpread(_objectSpread({}, searchParameters), {}, {\n                  location: []\n                })),\n                onSearch: e => handleSearch(e, \"locations\"),\n                children: searchOptionData.locations.map(data => /*#__PURE__*/_jsxDEV(_Select.Option, {\n                  value: data.id,\n                  children: data.name\n                }, data.id, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 326,\n                  columnNumber: 21\n                }, this))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 312,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Search, {\n                className: \"\",\n                loading: isSearching,\n                onChange: e => setSearchParameters(_objectSpread(_objectSpread({}, searchParameters), {}, {\n                  namaSKU: e.target.value\n                })),\n                placeholder: \"NAMA PRODUK / SKU\",\n                size: \"middle\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 331,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 264,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"w-full flex flex-col gap-y-3 gap-x-4 md:w-1/2\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                onClick: handleAdd,\n                className: \"bg-cyan-700 w-full cursor-pointer rounded px-5 h-10 hover:bg-cyan-800 shadow-sm flex items-center justify-center float-right\",\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"text-white text-center text-sm font-bold\",\n                  children: /*#__PURE__*/_jsxDEV(\"a\", {\n                    className: \"text-white no-underline text-xs sm:text-xs\",\n                    children: \"+ Tambah\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 350,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 349,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 345,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"grid grid-cols-3 gap-x-4 w-full\",\n                children: [/*#__PURE__*/_jsxDEV(UploadProduk, {\n                  setProduct: setProduct,\n                  fetchData: fetchData\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 356,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(ExportProduk, {\n                  data: product.data,\n                  setProduct: setProduct\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 357,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(DownloadTemplate, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 358,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 355,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 344,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 263,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(_Modal, {\n            className: \"rounded-lg m-5\",\n            head: true,\n            width: \"90%\",\n            centered: true,\n            visible: visible,\n            onOk: () => setVisible(false),\n            onCancel: () => setVisible(false),\n            bodyStyle: {\n              borderRadius: \"20px\",\n              backgroundColor: \"#E8F2F2\"\n            },\n            style: {\n              backgroundColor: \"#E8F2F2\",\n              border: \"2px solid #000\"\n            },\n            footer: null,\n            children: /*#__PURE__*/_jsxDEV(ProductModal, {\n              data: modalProduct,\n              isLoading: isLoading,\n              inventory: inventory\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 381,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 363,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(ProductTable, {\n            data: product,\n            onDelete: handleDelete,\n            onUpdate: handleUpdate,\n            onPageChange: handlePageChange,\n            setIsVisible: openModal,\n            setViewModalProduct: setModalProduct\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 388,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 262,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 260,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 259,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n\nProduct.getInitialProps = async context => {\n  const cookies = nookies.get(context);\n  let data;\n  const req = await fetchData(cookies);\n  data = await req.json();\n  const manufactures = await fetchSearchParametersData(cookies, \"manufactures\");\n  const categories = await fetchSearchParametersData(cookies, \"categories\");\n  const locations = await fetchSearchParametersData(cookies, \"locations\");\n  return {\n    props: {\n      data,\n      manufactures,\n      categories,\n      locations\n    }\n  };\n};\n\nconst formatData = data => {\n  const formattedData = data.map(item => {\n    return {\n      name: `${item.attributes.name}`,\n      value: item.id,\n      id: item.id\n    };\n  });\n  return formattedData;\n};\n\nconst fetchData = async cookies => {\n  const endpoint = process.env.NEXT_PUBLIC_URL + \"/products?populate=*\";\n  const options = {\n    method: \"GET\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: \"Bearer \" + cookies.token\n    }\n  };\n  const req = await fetch(endpoint, options);\n  return req;\n};\n\nconst fetchSearchParametersData = async (cookies, url) => {\n  const endpoint = process.env.NEXT_PUBLIC_URL + `/${url}?pagination[limit]=10`;\n  const options = {\n    method: \"GET\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: \"Bearer \" + cookies.token\n    }\n  };\n  const req = await fetch(endpoint, options);\n  const res = await req.json();\n  console.log(\"response\", res);\n  return formatData(res.data) || [];\n};\n\nexport default Product;","map":{"version":3,"sources":["/Users/yudiananta/Development/NextJS/ERP Dev/JS Deploy/ERP-Sejati/pages/dashboard/produk/index.js"],"names":["Head","React","useEffect","useState","LayoutContent","LayoutWrapper","useRouter","toast","nookies","DashboardLayout","TitlePage","ProductTable","ProductModal","UnitTableView","Manufactures","DownloadTemplate","ExportProduk","UploadProduk","Product","props","data","manufactures","categories","locations","isLoading","setIsLoading","product","setProduct","modalProduct","setModalProduct","isSearching","setIsSearching","visible","setVisible","router","inventory","setInventory","searchParameters","setSearchParameters","namaSKU","manufacture","location","category","searchOptionData","setSearchOptionData","Search","handleSearch","newValue","fetchSearchOption","query","cookies","get","endpoint","process","env","NEXT_PUBLIC_URL","options","method","headers","Authorization","token","req","fetch","res","json","status","resData","map","item","name","attributes","value","id","error","console","log","searchQuery","locationQuery","length","forEach","idx","handleAdd","push","handleView","handleUpdate","handleDelete","fetchData","success","handlePageChange","page","prevData","filterDuplicateData","concat","meta","arr","seen","Set","filteredArr","filter","el","duplicate","has","add","fetchInventory","openModal","e","target","borderRadius","backgroundColor","border","getInitialProps","context","fetchSearchParametersData","formatData","formattedData","url"],"mappings":"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","sourcesContent":["import Head from \"next/head\";\nimport React, { useEffect, useState } from \"react\";\nimport LayoutContent from \"@iso/components/utility/layoutContent\";\nimport LayoutWrapper from \"@iso/components/utility/layoutWrapper.js\";\nimport { useRouter } from \"next/router\";\nimport { toast } from \"react-toastify\";\nimport nookies from \"nookies\";\nimport DashboardLayout from \"../../../containers/DashboardLayout/DashboardLayout\";\nimport TitlePage from \"../../../components/TitlePage/TitlePage\";\nimport { Input, Modal, Select } from \"antd\";\nimport ProductTable from \"../../../components/ReactDataTable/ProductTable\";\nimport ProductModal from \"../../../components/Modal/ProductModal\";\nimport UnitTableView from \"../../../components/ReactDataTable/Product/UnitsTableView\";\nimport Manufactures from \"../../../components/Form/AddProduct/Manufactures\";\nimport DownloadTemplate from \"../../../components/Form/DownloadTemplate\";\nimport ExportProduk from \"../../../components/Form/ExportProduk\";\nimport UploadProduk from \"../../../components/Form/UploadProduk\";\n\nconst Product = ({ props }) => {\n  const data = props.data;\n  const manufactures = props.manufactures;\n  const categories = props.categories;\n  const locations = props.locations;\n  const [isLoading, setIsLoading] = useState(false);\n  const [product, setProduct] = useState(data);\n  const [modalProduct, setModalProduct] = useState();\n  const [isSearching, setIsSearching] = useState(false);\n  const [visible, setVisible] = useState(false);\n  const router = useRouter();\n  const [inventory, setInventory] = useState();\n  const [searchParameters, setSearchParameters] = useState({\n    namaSKU: \"\",\n    manufacture: \"\",\n    location: [],\n    category: \"\",\n  });\n  const [searchOptionData, setSearchOptionData] = useState({\n    manufactures: manufactures,\n    categories: categories,\n    locations: locations,\n  });\n  const { Search } = Input;\n\n  const handleSearch = (newValue, category) => {\n    if (newValue) {\n      fetchSearchOption(newValue, category);\n    } else {\n      setSearchOptionData({\n        manufactures: manufactures,\n        categories: categories,\n        locations: locations,\n      });\n    }\n  };\n\n  const fetchSearchOption = async (query, category) => {\n    const cookies = nookies.get(null);\n    try {\n      const endpoint =\n        process.env.NEXT_PUBLIC_URL +\n        `/${category}?filters[name][$containsi]=${query}`;\n      const options = {\n        method: \"GET\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: \"Bearer \" + cookies.token,\n        },\n      };\n\n      const req = await fetch(endpoint, options);\n      const res = await req.json();\n\n      if (req.status == 200) {\n        const resData = res.data.map((item) => ({\n          name: `${item.attributes.name}`,\n          value: item.id,\n          id: item.id,\n        }));\n\n        setSearchOptionData({ ...searchOptionData, [category]: resData });\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  // search query\n  useEffect(() => {\n    const searchQuery = async () => {\n      setIsSearching(true);\n      var query =\n        \"filters[$or][0][name][$contains]=\" +\n        searchParameters.namaSKU +\n        \"&filters[$or][1][SKU][$contains]=\" +\n        searchParameters.namaSKU;\n      var locationQuery = \"\";\n\n      if (searchParameters.manufacture) {\n        query += \"&filters[$and][2][manufacture][id][$eq]=\";\n        query += searchParameters.manufacture;\n      }\n\n      if (searchParameters.category) {\n        query += \"&filters[$and][3][category][id][$eq]=\";\n        query += searchParameters.category;\n      }\n\n      if (searchParameters.location.length > 0) {\n        searchParameters.location.forEach((item, idx) => {\n          locationQuery +=\n            \"&filters[$and][\" + (idx + 4) + \"][locations][id][$eq]=\" + item;\n        });\n      } else {\n        locationQuery = \"\";\n      }\n\n      const endpoint =\n        process.env.NEXT_PUBLIC_URL +\n        \"/products?populate=*&\" +\n        query +\n        locationQuery;\n\n      const cookies = nookies.get(null, \"token\");\n      const options = {\n        method: \"GET\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: \"Bearer \" + cookies.token,\n        },\n      };\n\n      const req = await fetch(endpoint, options);\n      const res = await req.json();\n\n      setProduct(res);\n      setIsSearching(false);\n    };\n\n    searchQuery();\n  }, [searchParameters]);\n\n  const handleAdd = () => {\n    console.log(\"\");\n    router.push(\"/dashboard/produk/tambah\");\n  };\n\n  const handleView = () => {\n    router.push(\"/dashboard/produk/lihat\");\n  };\n\n  const handleUpdate = (id) => {\n    console.log(\"\");\n    router.push(\"/dashboard/produk/edit/\" + id);\n  };\n\n  const handleDelete = async (id) => {\n    const endpoint = process.env.NEXT_PUBLIC_URL + \"/products/\" + id;\n    const cookies = nookies.get(null, \"token\");\n\n    const options = {\n      method: \"DELETE\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + cookies.token,\n      },\n    };\n\n    const req = await fetch(endpoint, options);\n    const res = await req.json();\n    if (res) {\n      const req = await fetchData(cookies);\n      const res = await req.json();\n      toast.success(\"Produk berhasil dihapus\");\n      setProduct(res);\n    }\n  };\n\n  const handlePageChange = async (page) => {\n    const cookies = nookies.get(null, \"token\");\n    const endpoint =\n      process.env.NEXT_PUBLIC_URL + \"/products?pagination[page]=\" + page;\n\n    const options = {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + cookies.token,\n      },\n    };\n\n    try {\n      const req = await fetch(endpoint, options);\n      const res = await req.json();\n      if (res) {\n        setProduct((prevData) => ({\n          data: filterDuplicateData(prevData.data.concat(res.data)),\n          meta: prevData.meta,\n        }));\n      } else {\n        console.log(\"something is wrong\");\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const filterDuplicateData = (arr) => {\n    const seen = new Set();\n\n    const filteredArr = arr.filter((el) => {\n      const duplicate = seen.has(el.id);\n      seen.add(el.id);\n      return !duplicate;\n    });\n\n    return filteredArr;\n  };\n\n  const fetchInventory = async (data) => {\n    setIsLoading(true);\n    const cookies = nookies.get(null, \"token\");\n    const endpoint =\n      process.env.NEXT_PUBLIC_URL +\n      `/inventories?filters[products][id][$eq]=${data.id}&populate=locations`;\n    const options = {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + cookies.token,\n      },\n    };\n\n    const req = await fetch(endpoint, options);\n    const res = await req.json();\n    // return req;\n    // console.log(res);\n\n    setInventory(res.data);\n\n    //\n  };\n\n  const openModal = async (e, data) => {\n    // console.log(\"test\", data);\n    setVisible(e);\n    fetchInventory(data);\n  };\n\n  useEffect(() => {\n    console.log(\"inventory\", inventory);\n    setIsLoading(false);\n  }, [inventory]);\n\n  return (\n    <>\n      <Head>\n        <title>Produk</title>\n      </Head>\n      <DashboardLayout>\n        <LayoutWrapper style={{}}>\n          <TitlePage titleText={\"Produk\"} />\n          <LayoutContent>\n            <div className=\"w-full flex justify-between gap-x-32 mb-3\">\n              <div className=\"w-full md:w-1/2 grid grid-cols-2 gap-x-4 gap-y-3\">\n                <Select\n                  size=\"middle\"\n                  allowClear\n                  showSearch\n                  showArrow={false}\n                  filterOption={false}\n                  notFoundContent={null}\n                  placeholder=\"PABRIKASI\"\n                  onSelect={(e) =>\n                    setSearchParameters({ ...searchParameters, manufacture: e })\n                  }\n                  onClear={() =>\n                    setSearchParameters({\n                      ...searchParameters,\n                      manufacture: \"\",\n                    })\n                  }\n                  onSearch={(e) => handleSearch(e, \"manufactures\")}\n                >\n                  {searchOptionData.manufactures.map((item) => (\n                    <Select.Option key={item?.id} value={item?.id}>\n                      {item.name}\n                    </Select.Option>\n                  ))}\n                </Select>{\" \"}\n                <Select\n                  size=\"middle\"\n                  allowClear\n                  showSearch\n                  showArrow={false}\n                  filterOption={false}\n                  notFoundContent={null}\n                  placeholder=\"KATEGORI\"\n                  onSelect={(e) =>\n                    setSearchParameters({ ...searchParameters, category: e })\n                  }\n                  onClear={() =>\n                    setSearchParameters({ ...searchParameters, category: \"\" })\n                  }\n                  onSearch={(e) => handleSearch(e, \"categories\")}\n                >\n                  {searchOptionData.categories.map((item) => (\n                    <Select.Option key={item?.id} value={item?.id}>\n                      {item.name}\n                    </Select.Option>\n                  ))}\n                </Select>\n                <Select\n                  mode=\"multiple\"\n                  size=\"middle\"\n                  placeholder=\"LOKASI\"\n                  allowClear\n                  onChange={(e) =>\n                    setSearchParameters({ ...searchParameters, location: e })\n                  }\n                  onClear={() =>\n                    setSearchParameters({ ...searchParameters, location: [] })\n                  }\n                  onSearch={(e) => handleSearch(e, \"locations\")}\n                >\n                  {searchOptionData.locations.map((data) => (\n                    <Select.Option key={data.id} value={data.id}>\n                      {data.name}\n                    </Select.Option>\n                  ))}\n                </Select>\n                <Search\n                  className=\"\"\n                  loading={isSearching}\n                  onChange={(e) =>\n                    setSearchParameters({\n                      ...searchParameters,\n                      namaSKU: e.target.value,\n                    })\n                  }\n                  placeholder=\"NAMA PRODUK / SKU\"\n                  size=\"middle\"\n                />\n              </div>\n              <div className=\"w-full flex flex-col gap-y-3 gap-x-4 md:w-1/2\">\n                <div\n                  onClick={handleAdd}\n                  className=\"bg-cyan-700 w-full cursor-pointer rounded px-5 h-10 hover:bg-cyan-800 shadow-sm flex items-center justify-center float-right\"\n                >\n                  <div className=\"text-white text-center text-sm font-bold\">\n                    <a className=\"text-white no-underline text-xs sm:text-xs\">\n                      + Tambah\n                    </a>\n                  </div>\n                </div>\n                <div className=\"grid grid-cols-3 gap-x-4 w-full\">\n                  <UploadProduk setProduct={setProduct} fetchData={fetchData} />\n                  <ExportProduk data={product.data} setProduct={setProduct} />\n                  <DownloadTemplate />\n                </div>\n              </div>\n            </div>\n\n            <Modal\n              className=\"rounded-lg m-5\"\n              head\n              width={\"90%\"}\n              centered\n              visible={visible}\n              onOk={() => setVisible(false)}\n              onCancel={() => setVisible(false)}\n              bodyStyle={{\n                borderRadius: \"20px\",\n                backgroundColor: \"#E8F2F2\",\n              }}\n              style={{\n                backgroundColor: \"#E8F2F2\",\n                border: \"2px solid #000\",\n              }}\n              footer={null}\n            >\n              <ProductModal\n                data={modalProduct}\n                isLoading={isLoading}\n                inventory={inventory}\n              />\n            </Modal>\n\n            <ProductTable\n              data={product}\n              onDelete={handleDelete}\n              onUpdate={handleUpdate}\n              onPageChange={handlePageChange}\n              setIsVisible={openModal}\n              setViewModalProduct={setModalProduct}\n            />\n          </LayoutContent>\n        </LayoutWrapper>\n      </DashboardLayout>\n    </>\n  );\n};\n\nProduct.getInitialProps = async (context) => {\n  const cookies = nookies.get(context);\n  let data;\n\n  const req = await fetchData(cookies);\n  data = await req.json();\n\n  const manufactures = await fetchSearchParametersData(cookies, \"manufactures\");\n  const categories = await fetchSearchParametersData(cookies, \"categories\");\n  const locations = await fetchSearchParametersData(cookies, \"locations\");\n\n  return {\n    props: {\n      data,\n      manufactures,\n      categories,\n      locations,\n    },\n  };\n};\n\nconst formatData = (data) => {\n  const formattedData = data.map((item) => {\n    return {\n      name: `${item.attributes.name}`,\n      value: item.id,\n      id: item.id,\n    };\n  });\n\n  return formattedData;\n};\n\nconst fetchData = async (cookies) => {\n  const endpoint = process.env.NEXT_PUBLIC_URL + \"/products?populate=*\";\n  const options = {\n    method: \"GET\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: \"Bearer \" + cookies.token,\n    },\n  };\n\n  const req = await fetch(endpoint, options);\n  return req;\n};\n\nconst fetchSearchParametersData = async (cookies, url) => {\n  const endpoint = process.env.NEXT_PUBLIC_URL + `/${url}?pagination[limit]=10`;\n  const options = {\n    method: \"GET\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: \"Bearer \" + cookies.token,\n    },\n  };\n\n  const req = await fetch(endpoint, options);\n  const res = await req.json();\n\n  console.log(\"response\", res);\n\n  return formatData(res.data) || [];\n};\n\nexport default Product;\n"]},"metadata":{},"sourceType":"module"}