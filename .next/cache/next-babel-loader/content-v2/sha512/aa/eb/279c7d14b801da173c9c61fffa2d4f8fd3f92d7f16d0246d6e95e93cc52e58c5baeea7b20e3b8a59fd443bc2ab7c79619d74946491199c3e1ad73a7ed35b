{"ast":null,"code":"import _Alert from \"antd/lib/alert\";\nimport _Spin from \"antd/lib/spin\";\nimport _defineProperty from \"/Users/yudiananta/Development/NextJS/ERP Dev/JS Deploy/JS-Deploy/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"/Users/yudiananta/Development/NextJS/ERP Dev/JS Deploy/JS-Deploy/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _Form from \"antd/lib/form\";\nimport _slicedToArray from \"/Users/yudiananta/Development/NextJS/ERP Dev/JS Deploy/JS-Deploy/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"/Users/yudiananta/Development/NextJS/ERP Dev/JS Deploy/JS-Deploy/pages/index.js\",\n    _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport _regeneratorRuntime from \"/Users/yudiananta/Development/NextJS/ERP Dev/JS Deploy/JS-Deploy/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport React, { useState } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useRouter } from \"next/router\";\nimport Input from \"@iso/components/uielements/input\";\nimport Button from \"@iso/components/uielements/button\";\nimport IntlMessages from \"@iso/components/utility/intlMessages\";\nimport authActions from \"../authentication/actions\";\nimport SignInStyleWrapper from \"../styled/SignIn.styles\";\nimport nookies from \"nookies\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar login = authActions.login;\nexport default function SignInPage(props) {\n  _s();\n\n  var dispatch = useDispatch();\n\n  var _Form$useForm = _Form.useForm(),\n      _Form$useForm2 = _slicedToArray(_Form$useForm, 1),\n      form = _Form$useForm2[0];\n\n  var router = useRouter();\n\n  var _useState = useState(false),\n      loading = _useState[0],\n      setLoading = _useState[1];\n\n  var _useState2 = useState(false),\n      failedLogin = _useState2[0],\n      setFailedLogin = _useState2[1];\n\n  var _useState3 = useState(\"Username atau Password salah\"),\n      failedLoginMsg = _useState3[0],\n      setfailedLoginMsg = _useState3[1];\n\n  var _useState4 = useState({}),\n      field = _useState4[0],\n      setField = _useState4[1];\n\n  var handleLogin = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n      var credentials, JSONdata, endpoint, options, req, res, role;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              e.preventDefault();\n              setFailedLogin(false);\n              setLoading(true);\n              credentials = {\n                identifier: field.username,\n                password: field.password\n              };\n              JSONdata = JSON.stringify(credentials);\n              endpoint = process.env.NEXT_PUBLIC_URL + \"/auth/local\";\n              options = {\n                method: \"POST\",\n                headers: {\n                  \"Content-Type\": \"application/json\"\n                },\n                body: JSONdata\n              };\n              _context.prev = 7;\n              _context.next = 10;\n              return fetch(endpoint, options);\n\n            case 10:\n              req = _context.sent;\n              _context.next = 13;\n              return req.json();\n\n            case 13:\n              res = _context.sent;\n              console.log(res);\n\n              if (!res.jwt) {\n                _context.next = 24;\n                break;\n              }\n\n              // set new token\n              nookies.set(null, \"token\", res.jwt, {\n                // maxAge: 30 * 24 * 60 * 60,\n                maxAge: 60,\n                path: \"/\",\n                secure: process.env.NEXT_PUBLIC_URL !== \"development\",\n                sameSite: \"strict\"\n              });\n              _context.next = 19;\n              return getUserInformation(res.jwt);\n\n            case 19:\n              role = _context.sent;\n              // set role token\n              nookies.set(null, \"role\", role, {\n                // maxAge: 30 * 24 * 60 * 60,\n                maxAge: 60,\n                path: \"/\",\n                secure: process.env.NEXT_PUBLIC_URL !== \"development\",\n                sameSite: \"strict\"\n              }); // redirect\n\n              router.replace(\"/dashboard\");\n              _context.next = 25;\n              break;\n\n            case 24:\n              setFailedLogin(true);\n\n            case 25:\n              _context.next = 31;\n              break;\n\n            case 27:\n              _context.prev = 27;\n              _context.t0 = _context[\"catch\"](7);\n              setFailedLogin(true);\n              setfailedLoginMsg(\"Kesalahan Pada Server. Silahkan cek kembali\");\n\n            case 31:\n              setLoading(false);\n\n            case 32:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[7, 27]]);\n    }));\n\n    return function handleLogin(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var getUserInformation = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(jwt) {\n      var endpoint, options, req, res;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              endpoint = process.env.NEXT_PUBLIC_URL + \"/users/me?populate=role\";\n              options = {\n                method: \"GET\",\n                headers: {\n                  \"Content-Type\": \"application/json\",\n                  Authorization: \"Bearer \" + jwt\n                }\n              };\n              _context2.next = 4;\n              return fetch(endpoint, options);\n\n            case 4:\n              req = _context2.sent;\n              _context2.next = 7;\n              return req.json();\n\n            case 7:\n              res = _context2.sent;\n              console.log(res);\n              return _context2.abrupt(\"return\", res.role.name);\n\n            case 10:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function getUserInformation(_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var onClose = function onClose(e) {\n    console.log(e, \"I was closed.\");\n  };\n\n  function setValue(e) {\n    var target = e.target;\n    var name = target.name;\n    var value = target.value;\n    setField(_objectSpread(_objectSpread({}, field), {}, _defineProperty({}, name, value)));\n  } // =========================== UI ===========================\n\n\n  return /*#__PURE__*/_jsxDEV(_Form, {\n    form: form,\n    name: \"add_order\",\n    initialValues: {\n      remember: true\n    },\n    onFinish: handleLogin,\n    children: /*#__PURE__*/_jsxDEV(SignInStyleWrapper, {\n      className: \"isoSignInPage\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"isoLoginContentWrapper\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"isoLoginContent\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"isoSignInForm\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"font-bold text-lg p-3\",\n              children: /*#__PURE__*/_jsxDEV(\"center\", {\n                children: \"LOGIN\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 133,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 132,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"isoInputWrapper\",\n              children: /*#__PURE__*/_jsxDEV(Input, {\n                onChange: setValue,\n                name: \"username\",\n                id: \"inputUserName\",\n                size: \"large\",\n                placeholder: \"Username\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 136,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 135,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"isoInputWrapper\",\n              children: /*#__PURE__*/_jsxDEV(Input, {\n                onChange: setValue,\n                id: \"inpuPassword\",\n                size: \"large\",\n                name: \"password\",\n                type: \"password\",\n                placeholder: \"Password\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 146,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 145,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"isoInputWrapper isoLeftRightComponent\",\n              children: loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"center\",\n                children: /*#__PURE__*/_jsxDEV(_Spin, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 159,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 158,\n                columnNumber: 19\n              }, this) : /*#__PURE__*/_jsxDEV(Button, {\n                htmlType: \"submit\",\n                className: \"bg-blue-400 text-white w-full hover:bg-blue-600\",\n                onClick: handleLogin,\n                children: /*#__PURE__*/_jsxDEV(IntlMessages, {\n                  id: \"page.signInButton\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 167,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 162,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 156,\n              columnNumber: 15\n            }, this), failedLogin ? /*#__PURE__*/_jsxDEV(_Alert, {\n              message: \"Login Error\",\n              description: \"Username atau Password salah\",\n              type: \"error\",\n              closable: true,\n              onClose: onClose\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 172,\n              columnNumber: 17\n            }, this) : /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 180,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 131,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 130,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 120,\n    columnNumber: 5\n  }, this);\n}\n\n_s(SignInPage, \"TUe5AW5cCsUnMbGGTAi8zDZZVSI=\", false, function () {\n  return [useDispatch, _Form.useForm, useRouter];\n});\n\n_c = SignInPage;\n\nvar _c;\n\n$RefreshReg$(_c, \"SignInPage\");","map":{"version":3,"sources":["/Users/yudiananta/Development/NextJS/ERP Dev/JS Deploy/JS-Deploy/pages/index.js"],"names":["React","useState","useDispatch","useRouter","Input","Button","IntlMessages","authActions","SignInStyleWrapper","nookies","login","SignInPage","props","dispatch","useForm","form","router","loading","setLoading","failedLogin","setFailedLogin","failedLoginMsg","setfailedLoginMsg","field","setField","handleLogin","e","preventDefault","credentials","identifier","username","password","JSONdata","JSON","stringify","endpoint","process","env","NEXT_PUBLIC_URL","options","method","headers","body","fetch","req","json","res","console","log","jwt","set","maxAge","path","secure","sameSite","getUserInformation","role","replace","Authorization","name","onClose","setValue","target","value","remember"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useRouter } from \"next/router\";\nimport Input from \"@iso/components/uielements/input\";\nimport Button from \"@iso/components/uielements/button\";\nimport IntlMessages from \"@iso/components/utility/intlMessages\";\nimport authActions from \"../authentication/actions\";\nimport SignInStyleWrapper from \"../styled/SignIn.styles\";\nimport { Spin, Alert, Form } from \"antd\";\nimport nookies from \"nookies\";\n\nconst { login } = authActions;\n\nexport default function SignInPage(props) {\n  const dispatch = useDispatch();\n  const [form] = Form.useForm();\n  const router = useRouter();\n  const [loading, setLoading] = useState(false);\n  const [failedLogin, setFailedLogin] = useState(false);\n  const [failedLoginMsg, setfailedLoginMsg] = useState(\n    \"Username atau Password salah\"\n  );\n  const [field, setField] = useState({});\n\n  const handleLogin = async (e) => {\n    e.preventDefault();\n    setFailedLogin(false);\n    setLoading(true);\n\n    const credentials = {\n      identifier: field.username,\n      password: field.password,\n    };\n\n    const JSONdata = JSON.stringify(credentials);\n    const endpoint = process.env.NEXT_PUBLIC_URL + \"/auth/local\";\n\n    const options = {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSONdata,\n    };\n\n    try {\n      const req = await fetch(endpoint, options);\n      const res = await req.json();\n      console.log(res);\n\n      if (res.jwt) {\n        // set new token\n        nookies.set(null, \"token\", res.jwt, {\n          // maxAge: 30 * 24 * 60 * 60,\n          maxAge: 60,\n          path: \"/\",\n          secure: process.env.NEXT_PUBLIC_URL !== \"development\",\n          sameSite: \"strict\",\n        });\n\n        const role = await getUserInformation(res.jwt);\n        // set role token\n        nookies.set(null, \"role\", role, {\n          // maxAge: 30 * 24 * 60 * 60,\n          maxAge: 60,\n          path: \"/\",\n          secure: process.env.NEXT_PUBLIC_URL !== \"development\",\n          sameSite: \"strict\",\n        });\n\n        // redirect\n        router.replace(\"/dashboard\");\n      } else {\n        setFailedLogin(true);\n      }\n    } catch (error) {\n      setFailedLogin(true);\n      setfailedLoginMsg(\"Kesalahan Pada Server. Silahkan cek kembali\");\n    }\n\n    setLoading(false);\n  };\n\n  const getUserInformation = async (jwt) => {\n    const endpoint = process.env.NEXT_PUBLIC_URL + \"/users/me?populate=role\";\n\n    const options = {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + jwt,\n      },\n    };\n\n    const req = await fetch(endpoint, options);\n    const res = await req.json();\n    console.log(res);\n\n    return res.role.name;\n  };\n\n  const onClose = (e) => {\n    console.log(e, \"I was closed.\");\n  };\n\n  function setValue(e) {\n    const target = e.target;\n    const name = target.name;\n    const value = target.value;\n\n    setField({\n      ...field,\n      [name]: value,\n    });\n  }\n\n  // =========================== UI ===========================\n\n  return (\n    <Form\n      form={form}\n      name=\"add_order\"\n      initialValues={{\n        remember: true,\n      }}\n      onFinish={handleLogin}\n    >\n      <SignInStyleWrapper className=\"isoSignInPage\">\n        <div className=\"isoLoginContentWrapper\">\n          <div className=\"isoLoginContent\">\n            <div className=\"isoSignInForm\">\n              <div className=\"font-bold text-lg p-3\">\n                <center>LOGIN</center>\n              </div>\n              <div className=\"isoInputWrapper\">\n                <Input\n                  onChange={setValue}\n                  name=\"username\"\n                  id=\"inputUserName\"\n                  size=\"large\"\n                  placeholder=\"Username\"\n                />\n              </div>\n\n              <div className=\"isoInputWrapper\">\n                <Input\n                  onChange={setValue}\n                  id=\"inpuPassword\"\n                  size=\"large\"\n                  name=\"password\"\n                  type=\"password\"\n                  placeholder=\"Password\"\n                />\n              </div>\n\n              <div className=\"isoInputWrapper isoLeftRightComponent\">\n                {loading ? (\n                  <div className=\"center\">\n                    <Spin />\n                  </div>\n                ) : (\n                  <Button\n                    htmlType=\"submit\"\n                    className=\"bg-blue-400 text-white w-full hover:bg-blue-600\"\n                    onClick={handleLogin}\n                  >\n                    <IntlMessages id=\"page.signInButton\" />\n                  </Button>\n                )}\n              </div>\n              {failedLogin ? (\n                <Alert\n                  message=\"Login Error\"\n                  description=\"Username atau Password salah\"\n                  type=\"error\"\n                  closable\n                  onClose={onClose}\n                />\n              ) : (\n                <div></div>\n              )}\n            </div>\n          </div>\n        </div>\n      </SignInStyleWrapper>\n    </Form>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}