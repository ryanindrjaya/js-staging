{"ast":null,"code":"import _notification from \"antd/lib/notification\";\nimport React from \"react\";\nimport nookies from \"nookies\";\nconst cookies = nookies.get(null, \"token\");\nvar tempProductListId = [];\nvar tempSupplierId = 0;\nvar tempLocationId;\n\nconst CreateOrder = async (grandTotal, totalPrice, values, listId, form, router) => {\n  // CLEANING DATA\n  var orderDate = new Date(values.order_date);\n  var deliveryDate = new Date(values.delivery_date);\n  var supplierId = {\n    id: parseInt(values.supplier_id)\n  };\n  tempSupplierId = parseInt(values.supplier_id);\n  tempLocationId = parseInt(values.location);\n  listId.forEach(element => {\n    tempProductListId.push({\n      id: element\n    });\n  });\n  values.order_date = orderDate;\n  values.delivery_date = deliveryDate;\n  values.supplier_id = supplierId;\n  values.status = \"Dipesan\";\n  values.delivery_total = grandTotal === 0 ? parseInt(totalPrice) : parseInt(grandTotal);\n  values.purchase_details = null;\n  values.supplier_id = null;\n  var data = {\n    data: values\n  };\n  const req = await createData(data);\n  const res = await req.json();\n\n  if (req.status === 200) {\n    await putRelationOrder(res.data.id, res.data.attributes, form, router);\n  } else {\n    openNotificationWithIcon(\"error\");\n  }\n};\n\nconst createData = async data => {\n  const endpoint = process.env.NEXT_PUBLIC_URL + \"/purchases\";\n  const JSONdata = JSON.stringify(data);\n  const options = {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: \"Bearer \" + cookies.token\n    },\n    body: JSONdata\n  };\n  const req = await fetch(endpoint, options);\n  return req;\n};\n\nconst putRelationOrder = async (id, value, form, router) => {\n  const user = await getUserMe();\n  const dataOrder = {\n    data: value\n  };\n  dataOrder.data.supplier = {\n    id: tempSupplierId\n  };\n  dataOrder.data.purchase_details = tempProductListId;\n  dataOrder.data.added_by = user.name;\n  dataOrder.data.locations = {\n    id: tempLocationId\n  }; // clean object\n\n  for (var key in dataOrder) {\n    if (dataOrder[key] === null || dataOrder[key] === undefined) {\n      delete dataOrder[key];\n    }\n  }\n\n  const JSONdata = JSON.stringify(dataOrder);\n  const endpoint = process.env.NEXT_PUBLIC_URL + \"/purchases/\" + id;\n  const options = {\n    method: \"PUT\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: \"Bearer \" + cookies.token\n    },\n    body: JSONdata\n  };\n  const req = await fetch(endpoint, options);\n  const res = await req.json();\n\n  if (req.status === 200) {\n    form.resetFields();\n    router.replace(\"/dashboard/pembelian/order_pembelian\");\n    openNotificationWithIcon(\"success\");\n  } else {\n    openNotificationWithIcon(\"error\");\n  }\n};\n\nconst getUserMe = async () => {\n  const endpoint = process.env.NEXT_PUBLIC_URL + \"/users/me\";\n  const options = {\n    method: \"GET\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: \"Bearer \" + cookies.token\n    }\n  };\n  const req = await fetch(endpoint, options);\n  const res = await req.json();\n  return res;\n};\n\nconst openNotificationWithIcon = type => {\n  if (type === \"error\") {\n    _notification[type]({\n      message: \"Gagal menambahkan data\",\n      description: \"Produk gagal ditambahkan. Silahkan cek NO PO atau kelengkapan data lainnya\"\n    });\n  } else if (type === \"success\") {\n    _notification[type]({\n      message: \"Berhasil menambahkan data\",\n      description: \"Produk berhasil ditambahkan. Silahkan cek pada halaman Pembelian Barang\"\n    });\n  }\n};\n\nexport default CreateOrder;","map":null,"metadata":{},"sourceType":"module"}